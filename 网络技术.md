# 网络技术

## 网络系统结构与设计的基本原则

### 计算机网络的分类

#### 1.局域网（LAN）

特点：

1. 覆盖有限的地理范围
2. 提供高数据传输效率（10Mbps~10Gbps）
3. 易于建立、维护与扩展

分类：

介质访问方法可分为介质式局域网与交换式局域网

传输介质类型可分为有线局域网与无线局域网

#### 2.城域网（MAN）

介于广域网与局域网之间的一种高速网络，覆盖范围为几十公里

#### 3.广域网

也称远程网，覆盖范围从几十公里到几千公里

因特网是广域网中最大的一个，广域网包含因特网

### 计算机网络结构的特点

#### 早期的广域网

逻辑功能上分为两部分：资源子网和通信子网

#### 用户计算机接入

用户计算机可以通过局域网方式连入，也可以通过电话交换网（**PSTN**）、有线电视网（**CATV**）、无线城域网（**WMAN**）、或无线局域网（**WLAN**）接入地区级主干网的城域网

### 广域网技术的发展（了解）

1. 广域网是一种公共数据网络

2. 构建广域网的核心交换技术
   - 公共电话交换网PSTN
   - 综合业务数字网ISDN
   - 数字数据网DDN
   - X.25 分组交换网
   - 帧中继（Frame Replay，FR）网
   - 异步传输模式（Asynchronous Transfer Mode，ATM）网
   - GE（Gigabit Ethernet，千兆以太网）与10GE的光以太网（Optical Ethernet）

### 局域网技术的发展（了解）

三个方向：

1.提高以太网的数据传输速率

2.将一个大型局域网划分成多个用网桥或路由器互联的网络

3.将共享介质方式改为交换方式。

​    在交换式局域网的基础上，出现了虚拟局域网（Virtual LAN，VLAN）

### 城域网技术的发展

宽带城域网的出现，使得传统的通信网络在概念、技术与应用上都发生了很多的变化。这些变化主要表现在：

①局域网、城域网与广域网在技术上的界限变得越来越模糊了；

②电信传输网技术与计算机网络技术的界限变得越来越模糊了；

③电信服务业务与Internet应用的界限变得越来越模糊了；

④电信传输网、计算机网络与广播电视网的界限变得越来越模糊了。

### 宽带城域网的结构

#### 逻辑结构

设计一个宽带城域网将涉及“三个平台和一个出口”，即**网络平台**、**业务平台**、**管理平台**与**城市宽带出口**等问题

<img src="C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210307191201810.png" alt="image-20210307191201810" style="zoom:67%;" />

#### 网络平台的层次结构

##### 核心交换层的基本功能

- 核心交换层将多个汇聚层连接起来，**为汇聚层的网络提供高速转发**，为整个城域网提供一个高速、安全与**具有 QoS 保障能力**的数据传输环境；
- 核心交换层实现与主干网络的互联，**提供城市的带宽 IP 数据出口**；
- 核心交换层提供带宽城域网的用户**访问 Internet 所需要的路由服务**；

##### 汇聚层的基本功能

- **汇聚接入层的用户流量**，进行数据分组传输的汇聚、转发、与交换;
- 根据汇聚接入层的用户流量，进行**本地**路由、过滤、流量均衡、Qos 优先级管理，以及安全控制、IP 地址转换、流量整形等处理；
- 根据处理结果把**用户流量转发到核心交换层**或**本地进行路由处理**；

##### 接入层的基本功能

- 接入层解决的是“最后一公里”的问题。通过各种接入技术，**连接最终用户**，为它所覆盖范围内的用户提供访问 Internet 以及其他的信息服务。

##### 三层结构思想：

上层负责下层的数据汇聚；

核心层提供出口与 QoS、汇聚本地路由，接入服务用户 

核心层：主要承担高速数据交换的功能。 

汇聚层：主要承担路由与流量汇聚的功能。 

接入层：主要承担用户接入与本地流量控制的功能。 

核心交换层 => 汇聚层 => 接入层

### 宽带城域网组建的基本原则（了解）

可运营性、**可管理性**、可盈利性、可扩展性

​    宽带的城域网设备必须支持对用户的**身份认证**、**使用权限认证**和**计费功能**。业务管理要支持多ISP、基于IP的虚拟专网VPN等多种增值业务。

​    宽带城域网必须具备**IP地址分配**能力，能够支持动态和静态地址分配，支持网络地址转换**NAT**功能。

​    宽带城域网必须能够为用户提供**带宽保证**，实现**流量工程**，提供个性化用户策略的**Qos保证**。

### 管理和运营宽带城域网的关键技术

#### 关键技术

1. 宽带管理
2. **网络管理**
3. **服务质量QoS**
4. **用户管理**
5. **IP 地址的分配与地址转换**
6. 多业务接入
7. 统计与计费
8. 网络安全

##### 网络管理

1. **带内网络管理是指利用传统的电信网络，通过数据通信网（ DCN ）或公共交换电话网（ PSTN ）拨号，对网络设备进行数据配置；**
2. **带外网络管理是指利用 IP 网络及协议进行网络管理，是利用简单网络管理协议（ SNMP ）建立网络管理系统；**
3. **对汇聚层一下采用带内管理，而对汇聚层及其以上设备采取带外管理；**

##### **服务质量QoS**

- **在带宽城域网业务中有多媒体业务、数据业务与普通话的语音服务；网络服务质量表现在延时、抖动、吞吐量和丢包率等几个方面；**
- 目前宽带城域网保证 QoS 要求的技术主要有：**资源预留(RSVP)**、**区分服务(DiffServ)**、与**多协议标记交换(MPLS)**。

##### 用户管理

宽带城域网的用户管理应该包括用户认证与接入管理、计费管理等，**能够为用户提供宽带保证，实现流量工程**。

##### IP 地址分配与地址转换

为了解决 IP 地址不足的问题，目前的**基本方案是使用内部专用 IP 地址与网络地址转换（ NAT ）技术，只为宽带城域网的关键设备与特殊用户分配固定的公用 IP 地址**。

### 构建宽带城域网的基本技术与方案

#### 基于SDH的城域网方案

早期的SONET/SDH是为传统电信业务服务的，它并不适合于传输IP分组

#### 基于10GE的城域网方案

光以太网是以太网与 DWDM 技术相结合的产物，其**造价是SONET的1/5，是ATM的1/10**。可运营光以太网的设备和线路必须符合典型网络 99.999% 的高运行可靠性，并具备以下特征：

1. 能供**根据终端用户的实际应用需求分配带宽**，保证带宽资源充分、合理的应用。
2. **具有认证与授权功能**，用户范文网络资源必须经过认证和授权，确保用户和网络资源的安全及合法使用。
3. **支持 MPLS（ 多协议标签交换 ）**，具有一定的质量保证，**提供分等级的 Qos 网络服务**。
4. **提供计费功能**，能及时获得用户的上网时间记录和流量记录，支持按上网时间、用户流量计费，或提供包月计费方式，支持实时计费。
5. **支持 VPN 和防火墙**，可以有效的保护网络安全。
6. 能够方便、快速、灵活的适应用户和业务的扩展。

#### 基于弹性分组环RPR技术的城域网（掌握）

弹性分组环是一种直接**在光纤上高校传输IP分组**的传输技术，它的工作基础是**Cisco公司**提出的**动态分组传送**（Dynamic Packet Transport, DPT）技术。

RPR 采用**双环结构**，有**内环**和**外环**。**顺时针传输**的光纤为**外环**，**逆时针传输**的光纤为**内环**。两环均可以用**统计复用**的方法传输 IP 分组，且可以实现“自愈环”的功能，**均可以传输数据分组与控制分组**。

每一个结点都可以使用两个方向的光纤与相邻结点通信。这样做的目的除了**高效地利用光纤带宽**之外，还有一个目的是**加速控制分组传输**，**提高环的可靠性**，**实行“环自愈”功能**，保证城域网的系统可靠性与服务质量。

两个 RPR 节点之间的裸光纤的最大长度可达到 **100km**，

1. **公平性好：**RPR 环中**每个节点都执行** **SRP 公平算法**，是的节点之间能供获得平等的带宽，防止个节点因流量过大而照成环拥塞。同时，RPR 环还支持加权公平法则和入口、出口峰值速率限制，用于保证能够根据用户购买的宽带提供相应的服务。
2. **带宽的利用率高：RPR 采用双环结构传输数据分组和控制分组**，**并限制数据帧只在源结点与目的结点之间的光纤段上传输，当源节点成功发送一个数据帧之后，这个数据帧要由目的节点从环中收回**。如此，该数据帧将不再占用下游段的环带宽，从而提高环带宽的利用率。
3. **保证服务质量：**RPR 环对不同的业务数据分配不同的优先级，以保证高优先级信息的可靠传输，从而保证了网络服务质量。
4. **快速保护和恢复能力：**RPR 有**自愈环**的功能，能够在**50ms**时间内，**隔离出故障节点和光纤段**，并可在没有专用带宽的前提下即能够提供 SDH 及的快速保护和恢复。

### 网络接入技术与方法

目前，可以用作用户接入网的主要有三类：计算机网络、电信通信网与广播电视网。

“三网融合”——计算机网络、电信通信网与电视通信网

- 从用户接入角度：用户接入可以分为接入技术与接入方式两种类型，其中接入方式与用户工作环境与需求相关。
- 从技术实现的角度，目前宽带接入技术主要有：**数字用户线（ xDSL ）技术**、**光纤同轴电缆混合网（ HFC ）技术**、**光纤接入技术**、**局域网接入技术**以及**无线接入技术**。其中，无线接入又可以分为无线局域网接入、无线城域网接入与无线 AD hoc 接入

###  各种接入技术的特点

#### 数字用户线 xDSL 接入技术

xDSL 中 x 的意思是表示它的不同类型,例如，可以理解 x 是 A、H 或 RA 等，他们对应于不同的数字用户线技术。xDSL 技术根据上行（ 用户到交换局 ）和下行（ 交换局到用户 ）的速率是否相同可分为**速率对称型**和**速率非对称型**两种。

- 非对称数字用户线（ Asymmetric Digital Subscriber Line , **ADSL** ）。
- 过比特率数字用户线（ High bitrate DSL, **HDSL** ）。
- 速率自适应数字用户线（ Rate adaptive DSL, **RADSL** ）。
- 甚高比特率数字用户线（ Very high bit rate DSL, **VDSL** ）。

ADSL 的技术特点主要表现在如下几个方面

- 能够利用现有的用户电话铜双绞线，以重叠和不干扰传统模拟电话业务的方式，即普通电话业务（POTS）的方式，提供高速数字业务。**ADSL 允许用户在保留已有的模拟电话业务**的同时，进行 Internet 在线访问、视频点播（VOD）的新型矿带业务。
- 该技术与本地环路由的实际参数以及用户电话铜双绞线的特性关系都不大，所以用户**不需要进行电缆的重新铺设**。
- **上行速率在 64 ~ 640Kbit/s，下行速率在 5000kbit/s ~ 7Mbit/s。用户根据需要自行选择。**

数据用户线 xDSL 接入技术的上行与下行速率：

| xDSL     | 上/下行速率（距离 5.5km） | 上/下行速率（ 距离 3.6km ） | 是否对称 | 线对称 |
| -------- | ------------------------- | --------------------------- | -------- | ------ |
| ADSL     | 64kbps/1.5Mbps            | 640kbps/6Mbps               | 否       | 1      |
| **HDSL** | **1.554Mbps**             | **1.5554Mbps**              | **是**   | 2      |
| VDL      | 2.3Mbps/51Mbps            | 2.3Mbps/51Mbps              | 否       | 2      |
| RADSL    | 64kbps/1.5Mbps            | 640kbps/6Mbps               | 否       | 1      |

#### 光纤同轴电缆合网接入技术

光纤同轴混合网HFC是**新一代有线电视网络**。光纤同轴电缆混合网HFC是一个**双向传输系统**。光纤结点将光纤干线和同轴分配线相互连接。

1.光纤同轴电缆合网的基本结构

- 是由电视头端、放大器、馈线与下引线组成。
- 新一代的有限电视网络，是一个 **双向传输系统** ，光纤节点通过电缆下引线可以为 **500 ~ 2000 个用户服务**。
- **改善了信号质量，提高了可靠性**，线路可以使用的宽带甚至可以达到 **1GHz** 。
- 从用户接入的角度来看，管线到 HFC 是经过双向改造的有限电视网络，是用户通过有线电视宽带接入 Internet 的一种重要的方式。
- 是使用 Cable Modem，通过有限电视宽带接入 Interent 的，数据传输速率可达 10 ~ 36Mbit/s

2.电缆调制解调器（Cable ModeM)

**Cable Modem 把用户计算机与有线电视同轴电缆连接起来**，不仅有调制解调功能，也带有加密解密和协议适配，以及网桥、路由器与集线器的部分功能。Cable Modem 利用 **频分复用** 的方法，**将双向信道分为：从计算机终端到网络方向称为上行信道，从网络到计算机终端方向称为下行信道**。上行信道带宽一般在**200 kbps ~ 10 Mbps**

- 从 **数据传输** 方向上，Cable Modem 可分为单向、双向两类。
- 从 **传输方式** 上，Cable Modem 可以分为**双向对称式传输**和**非对称式传输两类**。
- 从 **同步方式** 上，Cable Modem 可分为类似于 Etheme 的同步交换和类似于 ATM 技术的一部交换两类。
- 从 **接入的角度**，Cable Modem 可分为个人 Cable Modem 和宽带多用户Cable Modem。
- 从 **接口角度**，Cable Modem 可分为外置式，内置式和交互式机顶盒 3 种。

#### 光纤接入技术

APON（宽带无源光网络）是 ATMPON 的简称。**ATM 是一种基于信元的传输协议**，能为接入网 **提供动态的宽带分配**，从而更适合宽带数据业务的需求。

EPON（以太网无源光网络）是级语以太网的 PON 技术。EPON 采用点到多点结构、无源光纤传输，在以太网之上提供多种业务，**EPON 是一种实现光纤到户的重要技术**。

- 无线光纤网（PON）是 ITU “基于无源光纤网的高速光纤接入系统”下进行标准化的。
- **OC-3, 155.520Mbit/s 的对称业务**。
- **上行 OC-3, 155.520Mbit/s; 下行 OC-12, 622.020Mbit/s 的不对称业务**。
- **OC-(n) = 51.84 \* n Mbps**
- 传输介质可以是一根或两根单模光纤，双向传输通过波分复用（一根或两根光纤）实现。

#### 宽带无线接入技术

1. 无线接入技术的分类与应用

   **近距离使用可以采用 IEEE802.11 标准的无线局域网技术**（WLAN），它可以满足一定地理范围内的用户无线接入需求；**远距离使用则采用 IEEE802.16 标准的 WiMAX**，该技术可以在 50km 范围内提供最高 70Mbit/s 的传输速率。

   IEEE802.11 标准于 IEEE802.16标准均针对无线环境，但由于适用对象不同，采用的技术于协议解决问题的重点也不相同。**IEEE802.11 标准的重点在解决局域网范围的移动节点通信问题，而 IEEE802.16 标准的重点是解决建筑物之间的数据通信问题**。

2. IEEE802.11 标准与无线局域网

   - IEEE802.11 定义了使用**红外**、**调频扩频**与**直接序列扩频**技术，数据传输速率为 1Mbit/s 或 2Mbit/s;
   - **IEEE802.11a 将传输速率提高到 53Mbit/s**;
   - IEEE802.11b 定义了使用直序扩频技术，传输速率为 1Mbit/s、2Mbit/s、5.5Mbit/s 与 11Mbit/s;

3. IEEE802.16 标准与无线城域网

   - 按 IEEE802.16 标准建立采用 **全双工、宽带通信方式** 工作的基站。
   - IEEE802.16 标准规定了无线网络使用更高的、毫米波 **10 ~ 66GHz** 波段的频率。
   - 在 IEEE802.16 标准上增加了两个物理层标准 IEEE802.16d 与 IEEE802.16e;
   - **与 IEEE802.16 标准工作组对应的论坛组织是 WiMAX，最高的速率为 134Mib/s**

| 协议标准         | 使用频段          | 信道条件      | 固定/移动        | 行到带宽（MHz） | 传输速度（Mbit/s） | 额定小区半径（Km） |
| ---------------- | ----------------- | ------------- | ---------------- | --------------- | ------------------ | ------------------ |
| IEEE802.16       | 10~66GHz          | 视距          | 固定             | 25/28           | 32~134             | <5                 |
| IEEE802.16a      | <11GHz            | 非视距        | 固定             | 1.25/20         | 75                 | 5~10               |
| IEEE802.16d-2004 | 10~66GHz < 11GHz> | 视距 + 非视距 | 固定             | 1.25/20         | 75                 | 5~10               |
| IEEE802.16e-2005 | <6GHz             | 非视距        | 固定 移动 + 漫游 | 1.25/20         | 75                 | 若干               |

![image-20210322085836224](C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210322085836224.png)

## 中小型网络系统总体规划与设计

### 网络总体设计基本方法

#### 网络结构与拓扑构型设计方法

是否需要分成3层（核心层，汇聚层，接入层）组建的经验数据是：如果结点数为**250 ~ 5000个**，**一般需要按3层结构来设计**；如果结点为**100~500个**，**可以不必设计接入层网络**，结点直接通过汇聚层的路由器或交换机接入；如果结点数为**5~250个**，也**可以不设计接入层网络与汇聚层网络**。

#### 核心层网络设计

整个网络系统的主干部分是核心层，它是设计与建设的重点。目前应用于核心层网络的技术标准主要是 **GE/10GE**，核心设备是**高性能交换路由器**，连接核心路由器的是**具有冗余链路的光纤**。整个网络流量的 **40%~60%** 都需要由核心层网络承载。

- 直接接入核心路由器

  采取链路冗余的办法直接连接两台核心路由器，**其特点是直接利用了核心路由器的宽带，但是占用的核心路由器端口较多，而高端路由器的端口价格很高，所以设备成本会上升**。

- 通过专用交换机接入核心路由器

  在两台核心路由器之上增加一台连接服务器集群的交换机，同时采用 **链路冗余** 的办法，间接的连接到两台核心路由器，**其优点是可以分担核心路由器的带宽，缺点是会形成带宽瓶颈，存在单点故障的潜在危险**

#### 汇聚层网络与接入层网络结构设计

汇聚层网络可以将位于不同位置的子网连接到核心层网络，实现路由汇聚的功能。对网络系统进行分层设计可便于规划与分配带宽，有利于均衡负荷，提高网络效率。实际情况验证：**层次之间的上联带宽与下一级带宽之间比一般控制在 1:20**。

### 路由器关键设备选型

> 网络关键设备选型的基本原则：厂商与产品系列的选择、网络的可扩展性考虑、网络技术先进性考虑。

#### 路由器的分类

一般按路由器的性能进行分类，即可分为高端路由器（高端核心路由器）、中端路由器（或企业级路由器）与低端路由器。**路由器性能主要指路由器背板交换能力，背板交换能力大于 40Gbit/s 的称作高端路由器；背板交换能力低于 40Gbit/s 的称为中低端路由器**。

#### 路由器关键技术指标

- 吞吐量

  **路由器的吞吐量是指它的包转发能力**，涉及两个方面的内容：端口吞吐量与整机吞吐量。端口吞吐量是值路由器的某个端口的包转发能力，而整机吞吐量是指路由器整机的包转发能力。**路由器的吞吐量与路由器的端口数量和速率、包类型、包长度关系密切**。

- 背板能力

  背板是路由器输入端与输出端之间的物理通道，**它决定了路由器的吞吐量。高性能路由器一般采用交换式结构，而传统的路由器采用的是共享背板的结构**。

- 延时与延时抖动

  从数据包的第一个字节进入路由，到该帧的最后一个字节离开路由器期间所经历的时间就是所谓的延时。延时与**包长度**、**链路传输速率**有关。高速路由器一般要求为1518 B的IP包，延时要小于1 ms

  延时的变化量就是延时抖动。**由于数据包对延时抖动要求不高，所以一般不把延时抖动作为衡量高速路由器的主要指标，但是语音、视频业务对延时抖动要求比较高**。

- 丢包率

  丢包率是指在**持续的、稳定的**负荷情况下，由于包转发能力的限制而造成的丢失的概率。**丢包率常被用做路由器超负荷工作是的性能衡量指标**

- 突发处理能力

  常以 **最小帧间隔发送数据包而不引起丢失的最大发送速率来衡量突发处理能力**。

- 服务质量

  路由器的服务质量主要表现在**队列管理机制**、**端口硬件队列管理**和**支持 QoS 协议**上。**队列管理机制是指路由器的队列调度算法与拥塞管理机制**。

- 路由表容量

  **路由表是路由器用来决定包转发路径的主要依据**。建立和维护与当前网络链路状态与节点状态相适应的路由表是路由器的主要任务之一。路由表容量是指路由器可以存储的最多的路由表的数量。

  BGP协议的路由器一般要存储数万条路由表项。

- 典型的高端路由器的可靠性与可用性指标应该达到以下几点

  - 无故障连续工作时间（MTBF）**大于 10 万个小时**，且系统故障恢复时间 **小于 30min**。
  - **系统具有自动保护切换功能，主备用切换时间小于 50ms**。
  - **SDH 与 ATM 接口自动保护切换功能，切换时间小于 50ms**。
  - 路由器系统内部**不存在单故障点**。
  - 主路由器、主存储器、交换矩阵、电流、总线管理器与网络管理接口等主要部件需要由热插拔冗余备份，线卡要求有备份，并提供远程测试诊断能力。

- 网管能力

  **路由器的网络管理能力表现在网络管理员可以通过网络管理程序和通用的网络管理协议 SNMPv2**，对网络资源进行集中管理与操作。

### 交换机设备选型

#### 交换机的分类

- 按所支持的技术类型，可以将交换机分为 10Mbit/s Ethernet 交换机、Fast Ethernet 交换机速率达到 1Gbit/s 的 GE 交换机。
- 按内部结构，可以将交换机分为模块式交换机与固定端口交换机。
- 按应用规模，可以将交换机分为：企业级交换机、部门级交换机与工作组交换机。

#### 交换机的主要技术指标

主要技术指标：背板带宽、**全双工端口带宽**、交换方式、帧转发速率、延时、模块式或固定端口配置、支持 VLAN 能力等。

- **全双工端口带宽：计算方法 = 端口数 x 端口速率 x 2**。

### 网络服务器设备选型

#### 网络服务器的分类

1. 按照应用领域不同，可以将网络服务器分为： 

   Internet 通用服务器、

   数据库服务器、

   文件服务器

   应用服务器。

2. 按照网络应用规模不同，网络服务器可以分为：

   基础级服务器：1个CPU

   工作组级服务器：1~2个CPU

   部门级服务器：2~4个CPU，采用SMP技术

   **企业级服务器：4~8个CPU，采用SMP技术**

3. 按照网络服务器主机的硬件体系结构可以分为：

   基于 CISC 处理器 Inter 机构（IA）的 PC 服务器；

   基于 RISC 结构处理器的服务器；

   小型服务器。

   基于精简指令集（RISC）结构处理器的服务器与相应的 PC 服务器相比，CPU 处理能力提高了 50%-75%。**各种大型、中型计算机和超级服务器都采用 RISC 结构处理器，操作系统采用 UNIX**，所以通常将此类服务器作为 **UNIX 服务器**。

4. 服务器采用的相关技术

   **热插拔技术**、**集群（Cluster）技术**、高性能存储与智能 I/O 技术、对称多处理（Symmetric Multi-Processing, SMP）技术、应急管理端口（Emergence Management Port, EMP）技术、非一致内存访问（Non-Uniform Memory Access, NUMA）技术、服务器处理与 Intel 服务器控制（Intel Server Control, ISC）技术。

   - 热拔插技术

     **可以实现用户在不断电的情况下进行故障硬盘、板卡等部件的更换**，所以使得系统应对突发事件能力大大提高。另外，高端应用的磁盘镜像系统提高了磁盘的热插拔功能，大大缩减了系统故障修复时间。

     **注意**：如果系统式两个电源，则热插拔功能可以实现在用户不断电的情况下进行故障电源的更换。

   - 集群技术

     **集群（Cluster）技术大大提高了系统的数据处理能力**。它式向一组独立的计算机提供高速通信线路，并使其组成一个共享数据存储空间的服务器系统。**如果其中某台主机出现故障，该主机所运行的程序将立即转移到其他主机运行，可见集群计算技术可以使服务器的可用性、可靠性与容灾额能力得到大大提高**。

   - 高性能存储与智能 I/O 技术

     **存储能力使衡量服务器性能与选型的重要指标之一。评价高性能存储技术的主要指标使磁盘容量和存取 I/O 熟读**。在提高磁盘容量的基础上，通过改善并行读写能力，提高磁盘的存取速度和吞吐量；通过磁盘容错处理来解决系统的可靠性。

   - 对称多处理技术

     对称多处理（SMP）技术可以实现多 CPU 结构的服务器中的均衡负荷，从而提高系统效率。是否在多 CPU 结构的服务器中采用了对称多处理技术使一个重要指标。

   - 非一致内存访问（Non-Uniform Memory Access, NUMA）技术

     非一直内存访问（NUMA）技术实在多大 64 个或更多 CPU 的服务器之中，将集群技术与对称多处理技术结合起来应用，以求得较高的性价比。

   - 高性能服务器一般利用专用的服务处理器，对服务器系统的运行状况进行监控。

#### 网络服务器的性能

服务器的性能主要表现在：磁盘存储能力、运算处理能力、高可用性、可扩展性与可管理性等。

**系统高可用性可以用如下公式： 系统可用性 = MTBF / ( MTBF + MTBR )**。

其中，MTBF 为平均无故障时间； MTBR 为平均修复时间。

**如果系统高可用性达到 99.9%，那么每年的停机时间 <8.8 小时；系统高可用性达到 99.99%，每年的停机时间 <53 分钟；系统高可用性达到 99.999%，每年的停机时间 <5 分钟**。

## IP 地址规划技术

### IP地址分类及子网划分

#### 标准分类的 IP 地址

常用的 A 类、B 类、C 类采用包括“网络-主机号”的两级的层级结构。

IPv4 的 **地址长度是 32bit**，用 **点分十进制** 表示，如 x.x.x.x 的格式。其中每个 **x 为 8bit**，取值范围（00000000-11111111）,对应的十进制取值范围是（0-255）。

机器中存放的 IP 地址是 32 位二进制代码，每隔 8 为插入一个空格能提高可读性，将每 8 为的二进制数转换为十进制数，采用点分十进制记法则更加便于使用。

```markup
    10000000 00001011 00000011 0001111 => 128.11.3.31
```

![地址类别](https://bluexiaowei.github.io/NCRE3/static/images/03-01.png)

每个网络中“全 0”和“全 1”的主机号的地址有特殊用法，所以是需要去除的

| 地址类别 | 主机地址范围                | 可分配的网络数 | 每个网络内可分配的最大主机数 |
| -------- | --------------------------- | -------------- | ---------------------------- |
| A 类     | 1.0.0.0 ~ 127.255.255.255   | 27=128         | 224-2=16777214               |
| B 类     | 128.0.0.0 ~ 191.255.255.255 | 214=128        | 216-2=65534                  |
| C 类     | 192.0.0.0 ~ 223.255.255.255 | 221=2097152    | 28-2=254                     |

#### 特殊地址形式

特殊的 IP 地址包括：**受限广播地址、直接广播地址、“这个网络上的特定主机”地址**与回送地址。

1. 受限广播地址

   受限官博地址又称有限广播地址，该地址形式唯一，即：**32 位全为 1 的 IP 地址（255.255.255.255）**。此地址用来将一个分组以广播方式发送给本网络中的所有主机（本网内成员向全网广播）。

2. 直接广播地址

   **直接广播地址的形式是一个有效的网络号和一个全 1 的主机号**，用来使路由器将一个来自其他网络的分组以广播方式发送给特定网络上的所有主机。

   **在 IP 地址计算中：直接广播地址使 IP 地址网络号不变，主机号全为 1 的地址**。

3. “这个网络上的特定主机”地址——主机号

   “这个网络上的特定主机”地址用于同一网络内部某个主机或某个路由器向另一个主机发送分组。

   **“这个网络上的特定主机”地址的形式为一个全 0 的网络号和一个确定的主机号**。

   **在 IP 地址计算中：主机号是 IP 地址网络全为 0 主机号不变的地址**。

4. 回送地址

   A 类 IP 地址中的 127.0.0.0 是一个保留地址，它即回送地址。用于网络软件测试和本地进程间通信使用

   5.特殊地址

​	 IPv4为内部网络预留的专用IP地址有三组。第一组是A类地址的一个地址	块，这个地址中的地址空间为10.0.0.0~10.255.255.255；第二组是B类地	址的16个地址块（172.16~172.31）；第三组是C类地址的256个地址块	   （192.168.0~192.168.255）

#### 子网掩码

1. 地址结构

   标准的 A 类、B 类与 C 类 IP **地址都是网络号与主机号两级层次结构**。**IP 地址:: = {<网络号>，<主机号>}**

   子网采用网络号-子网号-主机号的三层 IP 地址结构。**IP 地址:: = {<网络号>，<子网号>，<主机号>}**

   从主机号借用若干个位作为子网号 subnet-id，而主机号 host-id 也就相应减少了若干个位。

2. 概念

   - 子网掩码主要是用来区分 IP 地址中的网络号（网络号+子网号）和主机号。
   - 子网掩码的结构与形式跟 IP 地址一样，也由 32 位的二进制组成，用点分十进制法表示。
   - 子网掩码与 IP 地址的对应关系是，IP 地址中网络号所在的位对应的子网掩码中的相应为 1，IP 地址中主机号所在的位对应的子网掩码中的相应位为 0。
   - **注意：IP 地址中网络号和主机号是由子网掩码来确定的，子网掩码二进制表示中全为 1 则对应 IP 地址位段的是网络号，全为 0 则对应 IP 地址位段的是主机号**。

   ![网络地址子网掩码组成图](https://bluexiaowei.github.io/NCRE3/static/images/03-02.png)

   子网内第一个可用的 IP 地址：子网号（网络地址）后的第一个地址。 子网内最后一个可用的 IP 地址：直接广播地址前一个地址。

3. 子网划分

   （1）判断客户需求的网络数与主机数。

   （2）配置满足需求的基本网络地址结构。

   （3）配置地址掩码。

   （4）配置网络地址。

   （5）配置网络广播地址。

   （6）配置网络的主机地址。

   规划子网地址的基本步骤

   - 确定要划分的**子网数**
   - 求出子网数目对应二进制的位数 N 以及主机数目对应二进制的位数 M。
   - 在该 IP 地址的原子网掩码的基础上，将其主机地址部分的前 N 位置取 1 和后 M 位置取0，即得出该 IP 地址划分子网后的子网掩码。

   规划子网地址的基本思想

   - 熟记 2 的幂：1，2，3，8，16，64，128，256。
   - 用过划分子网可以将一个网络划分若干个小网络以满足不同部门的需要，而从外部来看仍然像一个网络一样。划分子网即优化网络性能又提高了网络管理的效率。

   划分子网的基本方法

   - 你选择的子网掩码将会产生多少个子网？2^N-2（N 代表网络位借用主机的位数）。
   - 每个子网能有多少主机？2^M-2（M 代表主机位）。
   - 每个子网的网络地址：主机位全为 0。
   - 每个子网的广播地址：主机位全为 1。

#### 可变长度子网掩码（VLSM）

​    VLSM是在标准的掩码上面再划分的子网的网络号码，无类路由选择网络可以使用VLSM，而有类路由选择网络中不能使用VLSM。

##### 可变长度子网掩码（VLSM)地址规划方法



### 无类域间路由技术（CIDR）

> 无类域间路由的设计思想是：不按标准的地址分类规则分配剩余的 IP 地址，而是以可变大小的块方法分配。

- 消除了传统的 A 类、B 类和 C 类地址以及划分子网的概念，可以更有效的分配 IPv4 地址空间。 IP 地址:: = {<网络前缀>, <主机号>}
- 使用 **各种长度的“网络前缀”来代替分类地址中的网络号和子网号**。
- **使用“斜线记法”，又称 CIDR 记法，及在 IP 地址后面加上一个斜线“/”**，然后写上网络前缀所占的位数（对应三级编址中子网掩码 1 的个数）。
- CIDR 把 **网络前缀相同的连续的 IP 地址组成一个 CIDR 地址块**。
- **全 0 和全 1 的主机号地址一般不适用**。

#### CIDR地址规划方法

无类域间路由CIDR接收通常用在将多个C类IP地址归并到单一的网络中，并且在路由表中使用一项来表示这些C类IP地址。

**CIDR技术的主要应用：**

1.构建超网           

2.路由聚合

### NAT工作原理

> NAT（网络地址转换）技术是解决 IP 地址短缺问题，可以 **时间将内部玩咯专用的 IP 地址可以转换为用于访问外网的全局 IP 地址**。

![网络地址类别](https://bluexiaowei.github.io/NCRE3/static/images/03-03.png)

#### NAT 的工作原理

<img src="https://bluexiaowei.github.io/NCRE3/static/images/03-04.png" alt="NAT的工作原理" style="zoom:150%;" />

#### NAT技术类型

①静态NAT （一对一）

②动态地址NAT  （一对多）

③网络地址端口转换NAPT （一对多，端口区分）

### IPv6地址的特点

#### IPv6 的表示方法

- 用二进制格式表示 **128位** 的一个 IPv6 地址。
- 将这个 128 位的地址按 每16位为一个段位，划分为 8 个段位。
- 将每个段位转换成十六进制数，并用 **冒号（:）** 隔开。`68E6:8C64:FFFF:FFFF:0:1180:960A:FFFF`。
- 若某个 IPv6 地址中出现多个连续的二进制数 0，可以通过压缩某个段位中的 **前导 0** 来简化 IPv6 地址的表示。 `002F` => `2F`
- 如果某个 IPv6 地址中包含了一长串 0，在以冒号十六进制表示法表示时，**可以将连续的段位值都为 0 的地方简写为 `::`，称为双冒号表示法。** `FF05:0:0:0:0:0:0:0:B3` => `FF05::B3`
- **双冒号在一个地址中只能出现一次**

#### IPv6的分类

IPv6的地址分为：单播地址、组播地址、多播地址与特殊地址等基本的四类地址，同时它还加入了对自动配置的支持 。

## 路由器设计基础

### 路由相关术语

#### 分组转发

分组的传送采用存储-转发凡是，即玩咯节点根据分组控制信息，分组送到下一节点，下一节点接收到分组后，暂时保存下来并排队等候传输，然后根据分组控制信息把该分组传送到下一节点，直至到达最终目的。

#### 路由算法分类

**静态路由选择算法** 也称为非自适应路由选择，其路由信息是由 **网络管理人员手工配置** 的，且需要网络管理人员手动修改路由表中的路由表项，以适应玩咯拓扑结构变化或网络链路状态的变化。**动态路由选择算法** 也叫做自适应路由选择，其路由信息是通过相互连接的路由器彼此之间 **交换路由信息**，然后按照一定的算法 **计算并优化** 而得出的，同时为适应不断变化的网络，还需要在一定时间间隙对这些路由信息不断更新，以即使获得最有的路径选择效果。

#### 路由的度量标准

- 跳数：分组从源节点到目的即节点所经过路由器的个数
- 带宽：链路的传输速率，用来表示通信线路所能传送数据的能力
- 延时：分组从源节点到达目的节点所花费的时间
- 负载：单位时间内通过路由器或线路的通信量
- 可靠性：传输过程中的误码率，域网络的质量和性能有密切的关系
- 代价：传输过程中的耗费，通常域所使用的链路带宽相关，一般来说，网络的速率越高，其代价也越高。 

### IP 路由选择和路由汇聚

- 无类域间路由协议（CIDR）**支持通过子网划分的相反过程** 来汇聚路由表项。
- 无类域间路由协议使用 **网络前缀法表示路由表的表现**，具体路由表的项目表示由 **“网络前缀”和“下一跳地址”** 两项内容组成。
- 路由选择变为从匹配结果中选择具有最长网络前缀的路由的过程，这就是 **最长前缀匹配**

### 路由信息协议（RIP）

#### RIP 的基本概念

RIP（路由信息协议）是一种 **分布式、基于距离向量** 的内部网关协议，适用于小型同类网络的一个自治系统内的路由细心的传递。是使用 **跳数** 来衡量到达目的地址的路由距离。

#### RIP 的原理

- 路由刷新报文主要内容由若干个**（V, D）**组成的表。（V, D）表中的 **V 表示“矢量**，标识该路由器可以到达的目的网络或者目的主机；**距离 D 对应路由上的“跳数”**。
- RIP 规定，路由器 **每 30 秒向外广播一个（V, D）报文（周期性）**，报文信息来自本地路由器表。
- RIP 规定，一条有限的 **路径长度不得超过 15**，超过 15 则以为路径无限长，即路径不存在。

#### RIP 的运行过程

![RIP 的运行过程](https://bluexiaowei.github.io/NCRE3/static/images/04-01.png)

### 最短路径优先协议（OSPF）

#### OSPF 协议概述

- 开放最短路径优先（OSPF）协议，也是 **内部网关协议** 的一种，克服 RIP 的缺点开发出来的。
- 开放式最短路径优先协议 **组要用于在自治系统内部路由器之间传输路由信息**。
- 开放式最短路径优先协议不采用距离矢量的路由算法，而是 **基于 Dijkstra 提出的最短路径算法规则计算路径**。
- 开放式最短路径优先协议还 **支持分层网络**，这使得它的应用更加具有广泛性和灵活性。

#### OSPE 协议的特征

- OSPE 主要的特征是使用 **分布式链路状态协议**，而 RIP 使用的是距离向量协议；
- OSPE 协议要求路由器发送的信息是本路由器与那些相邻路由器，以及链路状态的质量。**链路状态“度量”组要是指费用、距离、延时、带宽等**。
- OSPF 协议要求当链路状态发生变化时用 **“洪泛法”** 向所有路由器发送此信息，而 RIP 仅向自己相邻的几个路由器发送交换路由信息。
- OSPF 协议的路由器之间频繁的交换链路状态信息，**区域内部路由器只知道本区域的完整网络拓扑，而不知道其他区域的网络拓扑情况**
- 为了适应规模很大的网络，并使更新过程收敛的更快，OSPE 协议将一个自治系统再划分为若干个更小的范围，叫做 **区域**。
- 每个区域有个 **32 位区域标识符**（用点分十进制表示），再一个区域内的路由器数 **不超过 200 个**。
- 所有的OSPF路由器交换链路状态信息，最终建立一个**链路状态数据库**， 这个数据库实际上就是该区域全网的拓扑结构图；

### 外部网关协议（BGP）

自治系统 AS 的定义：在单一的技术管理下的一组路由器，而这些路由器使用一种 AS 内部的路由选择协议和共同的度量以确定分组在 AS 内的路由，同时还使用一种 AS 之间的路由选择协议用以确定分组在 AS 之间的路由。

![外部网关协议(BGP-4)](https://bluexiaowei.github.io/NCRE3/static/images/04-02.png)

#### BGP 的主要特点

- 是一种外部网关协议，是在 AS 之间传递路由信息以及控制优化路由信息；
- 是一种“**路径矢量**”路由协议，其路由信息中携带了所经过的全部自治系统的路由列表；
- 为了保证 BGP 的可靠传输，其使用 TCP 来承载协议报文；

#### BGP边界路由器的初始化过程：

BGP刚刚运行时，交换整个路由表，以后只需要在发生变化时更新有变化的部分；

#### BGP 路由协议四种分组

- **打开（OPEN）报文**：采用与相邻的另一个 BGP 发言人建立关系。
- **更新（UPDATE）报文**：用来发送某一路由的信息，以及列出要撤销的多条路由。
- **保活（KEEPALIVE）报文**：用来确认打开报文和周期性（30 秒）的证实邻站关系。
- **通知（NOTIFICATION）报文**：用来发送检测到的差错。

## 局域网技术基础及应用

### 局域网

#### 交换式局域网的基本概念

交换式局域网的核心是交换机。局域网交换机可以在它的多个端口之间建立多个并发连接。它主要采用两种转发方式：**快捷交换方式**与**存储转发交换**方式。

#### 虚拟局域网的基本概念

虚拟局域网（virtual LAN，VLAN）：是建立在交换技术的基础上，它是以**软件**的方法将网络中的结点按工作性质与需要划分成若干个“**逻辑工作组**”，每个逻辑工作组就是一个虚拟网络。

IEEE于1999年公布了VLAN的IEEE802.1Q标准。 

虚拟局域网组网定义方法通常有四种：

1、基于端口的虚拟局域网

2、基于MAC地址的虚拟局域网

3、基于网络层地址定义的虚拟局域网

4、基于IP广播组的虚拟局域网。

### 以太网组网的基本方法

#### 以太网的物理层标准的命名方法

传统以太网的物理层标准的命名方法是：

| IEEE802.3 x （Mb/s） | Type-y | Name （局域网名称） |
| -------------------- | ------ | ------------------- |

其中，x为该Ethernet数据传输的速率，单位是Mb/s；Type为传输的方式，基带或频带；y为网络的最大长度，单位是100m；Name是局域网的名称

#### 10BASE-T标准以太网组网的设计方法

标准（传统）以太网可以选择10BASE-5、10BASE-2或10BASE-T中的任意一种或几种的组合。目前标准的设计方案都采用10BASE-T标准，使用集线器、非屏蔽双绞线和RJ-45接口。

集线器工作在物理层，所有连接在一个集线器上的结点都属于同一个“**冲突域**”。在任何一个时间段中，只能有一个结点可以发送数据帧，而其他结点只能处于接受状态

#### 快速以太网组网的设计方法

##### 快速以太网的基本特点：

- 快速以太网协议标准为IEEE802.2u。基本特点如下：
- 保持传统以太网帧结构与介质访问控制方法不变；
- 在LLC子层使用IEEE802.3标准，在MAC子层使用CSMA/CD方法；
- 数据传输速率提高到100Mbps；
- 提供10Mbps与100Mbps速率自动协商功能。

##### 快速以太网介质专用接口MII （了解）

- MII将MAC子层和物理层分隔开来。
- MII向上通过与MAC子层得接口提供载波侦听信号与冲突检测（CSMA/CD）信号，向下支持10Mbps与100Mbps速率的接口，以及与集线器交换控制信息的功能。

##### 快速以太网的物理层标准

①100BASE-TX：使用**5类非屏蔽双绞线或屏蔽双绞线**的快速以太网技术，它使用两对双绞线，**一对用于发送**，**一对用于接收数据**。在传输中使用**4B/5B编码**方式。他的最大网段长度为**100m**。它支持**全双工**的数据传输。

②100BASE-FX：使用**2条光纤**，最大长度为**415m**，**一条光纤用于发送**，另一**条光纤用于接收**；数据传输采用**4B/5B-NRZI编码**方法；采用**全双工**方式工作。

③100BASE-T4：它使用**4对3类非屏蔽双绞线**，**3对用于传送数据**，**1对用于检测冲突信号**。在传输中使用**8B/6T编码**方式，它使用与10BASE-T相同的RJ-45连接器，最大网段长度为**100m**；采用半**双工方式**工作。

##### 全双工与半双工工作模式(了解)

①全双工（Full Duplex Communication）是指在通信的任意时刻，线路上存在A到B和B到A的双向信号传输。在全双工方式下，通信系统的每一段都设置了发送器和接收器，因此，能控制数据同时在两个方向上传送。

②半双工（Half Duplex Communication）是指在通信过程的任意时刻，信息既可以有A传到B，又能由B传到A，但只能有一个方向上的传输存在。

​    与传统以太网的连接方式不同，全双工工作是一种**点-点**连接方式，支持全双工模式的快速以太网的拓扑构型一定是星形。

​    传统以太网将很多个主机连接在一条共享的同轴电缆上，主机之间需要争用共享的传输介质，因此就出现了CSMA/CD介质访问控制方法。点-点连接方式不存在争用问题，因此**不需要采用CSMA/CD介质访问控制方法**。

##### 10Mbps与100Mbps速率自动协商功能

速率自动协商应具有以下功能：

①自动确定非屏蔽双绞线的远端连接设备使用的是半双工（CSMA/CD）的10Mpbs工作模式，还是全双工的100Mbps工作模式；

②向其他节点发布远端连接设备的工作模式；

③与远端连接设备交换工作模式相关参数，协调和确定双方的工作模式；

④自动协商功能自动选择共有的最高性能的工作模式。

自动协商过程只能用于使用双绞线的以太网，并且规定自动协商过程需要在**500ms**内完成。

按工作性能从高到底，网络协议的优先等级从高到低排列为：

- 100BASE-TX或100BASE-FX全双工模式；
- 100BASE-T4半双工模式；
- 100BASE-TX半双工模式；
- 10BASE-T全双工模式；
- 10BASE-T半双工模式。

### 综合布线之网络系统设计

#### 综合布线的概念

综合布线系统（Premises Distributed System, PDS）是 **建筑物内或建筑物间** 的只用结构化、高灵活性的信息传输通道，其对象是建筑物或建筑物之间的传输网络，旨在使语音和数据通讯设备、交换设备和其他信息管理系统彼此相连，并使这些设备与外部通信网络连接。

#### 综合布线系统组合

![综合布线系统组合](https://bluexiaowei.github.io/NCRE3/static/images/05-01.png)

#### 综合布线系统的网络拓扑结构

综合布线系统的网络头普结构包含何种网络单元，并按经济合理原则和技术性能要求对这些网络单元进行组合和配置。

- 组合配置包括 **组合逻辑和配置形式**，**组合逻辑描述网络功能的拓扑结构**。
- 配置形式则说明传输路线与交换中心的交换情况，即 **网络单元的邻接关系**。
- 在局域网中布线中常用的拓扑结构有 **星行、环行、总线型和网状结构**等，其中星形结构应用最为广泛。

#### 综合布线系统的主要布线

- 连接设备：**指综合布线系统中的各种连续设备**。各种适配器（主件的连接器）、成对连接器及接插软线，都属于连接设备，如配线架、光纤耦合器等。如局域网设备、阻抗匹配设备、滤波器或保护器等，都不属于连接设备。
- 传输介质：常用的传输介质有双绞线、光缆 2 大类。
  1. 双绞线：分为 **非屏蔽双绞线和屏蔽双绞线**两种。
     - 非屏蔽双绞线电缆（UTP）的线对外 **没有金属屏蔽层，抗电磁干扰能力差**，使用是受外力弯曲和牵拉，**易导致均衡绞距受破坏**，同时该种电缆在传输信息是易向外辐射泄漏，**安全性较差**；但由于 **其体积小、重量轻、弹性好且价格低**，故是 **结构化布线系统中最常用的通信介质**。
     - 屏蔽双绞线电缆（STP）的线对 **外包有一层金属箔，具有较好的抗干扰性**，但存在 **价格高，体积大，重量大，不宜施工** 等不足，主要用于外界电磁干扰较大或对数据传输安全性要求较高的环境中。

### 综合布线之子系统设计

#### 建筑群子系统设计

建筑群子系统的通信线路的铺设主要有 **地下管道布线、直埋布线、架空布线和巷道布线** 4 种方式或者是这 4 种方式的任意组合。

- 地下管道布线：通过由入孔和管道组成的地下系统，对网络内的建筑物进行互联，该方式能 **保持建筑物的原貌。采用由耐腐蚀材料的管道，能对电缆提供最好的机械保护，有效减低电缆受损维修风险**
- 直埋布线：除穿过基础墙的线缆外，**电缆其余部分均不采取管道保护**。 该方法可 **保持建筑物的外贸**。基础墙的电缆孔需要向外尽量延伸至不需动图的地方，从而避免其他人沿墙动土时破坏线缆。
- 架空布线：在建筑物间悬空，并通过 **电线杆支撑**。电缆可采用自支撑电缆或将户外电缆系在钢丝绳上。该方式安全性、保密性、灵活性较差，且影响美观，故 **不是理想的布线方式**。只有在已有电线杆前提下使用，但布线成本低。
- 巷道布线：利用建筑物间的地下管道（如用于传送集中供暖站热水的热水管）进行电缆敷设。**可充分利用原有安全设施，且造价低**。电缆安装位置应与热水管保持一定距离，以防热水或热气损坏电缆；电缆尽可能安置在巷道内较高位置，以防水淹。

#### 设备间子系统

设备间是线路管理的集中点，是配线设备和通信设备的所在地，，是安放众多用户公用通信装置的场所。设备间子系统连接主配线区（电缆进线室、MDF交接箱）、程控交换机（PBX）或局域网交换机等设备。**在设备间子系统，通过垂直干线或水平干线子系统连接道管理子系统**。

设备间**室温**应保持在**10℃-27 ℃**之间，**相对湿度**应保持在30%-80%,照明满足标准，并有良好的防尘措施。

#### 管理子系统

管理子系统设置在楼层配线间，时水平子系统电缆端接和主干系统电缆端标的场所，设置在漏乘配线间中，由楼宇主配线架、楼层分配线架、转换插座及跳线组成，包括干线间或卫星接线间内的交叉互联设备。**用户可以通过在管理子系统中增加、交换、更改、扩展线缆来改变线路路由**。

#### 干线子系统

干线子系统即建筑物**主馈电缆**，包括：干线接线间至各远程通信（卫星）接线间、设备间至网络端口、主设备间和计算机中心之间、设备间至建筑群子系统设施间的连接电缆，这备件的主干线缆。

干线子系统主要有 **点对点结合、分支结合** 两种。这两种连接方式根据建筑物结构特点以及经济性等情况可单独采用也可以混合使用。

#### 水平子系统设计

水平子系统时综合布线系统的分支部分，时综合布线工程中工程量最大、范围最广、最难施工的一个子系统，**一般电缆长度不超过 90m**。综合布线系统多采用 5 类和 6 类 4对 **非屏蔽双绞线**。**对于用户有高速率终端要求的场合，可采用光纤直接铺设到桌面的方案**。

#### 工作区子系统设计

工作区子系统指终端**设备出线到信息插座**的整个区域。可支持常见的终端设备电话机、计算机、数据终端、传感器以及监视器等。

1. 信息插座类型和数量的确定：信息插座有**嵌入式安装插座（暗座）**、**多介质信息插座（光纤和铜缆）**和表面安装插座等类型可提供选择。其中嵌入式安装插座用于连接双绞线，**多介质信息插座可用于连接铜缆和光纤，用以满足用户“光纤到桌面”的需求**。
2. 适配器的选用：
   - **当设备连接器采用不同于信息插座的连接器**时，可以选择专用电缆或适配器。
   - **在单一信息插座上进行两项服务时**，宜采用一线两用器或“Y”形适配器。
   - **连接使用不同信号的数模转换或数据速率转换装置**时，宜采用适配器。
   - 水平子系统中 **选用的介质类别（电缆）与设备所需的介质类别（电缆）**不同时，宜采用适配器。

### 局域网互联设备—集线器

#### 中续器（Repeater）

中续器是一种最简单的网络互联设备，主要完成**物理层**的功能，负责在两个节点的物理层上按位传递信息，完成信号的复制、调整和放大功能。

![中续器](https://bluexiaowei.github.io/NCRE3/static/images/05-02.png)

#### 网桥（Bridge）

网桥是连接两个局域网的设备，**工作在 MAC 子层上**，并且它可以完成具有相同或相似体系结构的网络系统的连接。**网桥是依靠 MAC 地址表确定帧是否需要转发，以及向何处转发**。

网桥能够互联两个**采用不同数据链路层协议**、**不同传输介质**与不同传输速率的网络

透明网桥和源路由网桥的标准分别由 IEEE 802.1 与 IEEE 802.5 两个分委员定制。**其中透明网桥的标准为 IEeE 802.1d**。

透明网桥采用生成树算法，来防止出现坏路情况。    根据该算法所制定的协议即称为**生成树协议**(spanning tree protocol, **STP**) 。**生成树协议能够逻辑地阻断网络中存在的冗余链路，以消除路径中的环路，并可以在活动路径出现故障时，重新激活冗余链路来恢复网络的连通，保证网络的正常工作**。

#### 交换机

交换机是一种基于 MAC 地址识别，能完成封装转发数据包功能的网络设备。

二层交换机工作与数据链路层，他建立和维护一个 **表示 MAC 地址与交换机端口对应关系的交换表**。

三层交换技术就是二层交换技术上加上三层转发技术，是在网络模型中的第三层实现了数据包的高速转发，即可 **实现网络路由功能**， 又可根据不同网络状况做到最优网络性能1

#### 集线器

集线器的主要功能是对接收到的信号进行再生整形放大，以扩大网络的传输距离，同时把所有节点集中在以它为中心的节点上。**它发送数据时都是没有针对性的，而是采用广播方式发送**。

工作在 **物理层**，**所有节点通过双绞线连接到一个集线器上**，执行 **CSMA/CD 介质访问控制方法**。当一个节点发送数据时，所有节点都能接受到。**连接到一个集线器的所有节点共享一个冲突域**。

通过在网络链路中 **串接一个集线器可以监听该链路中的数据包，连接到一个集线器的多个节点不能同时发送数据帧可以同时接受数据帧**。

## 交换机及其配置

### 交换机的基本概念

#### 基本概念

局域网交换机是一种 **基于 MAC 地址** 识别，完成转发数据帧功能的一种网络连接设备。

它工作在数据链路层，**根据端口数据帧中的 MAC 地址进行数据帧的过滤、转发（也是交换机的工作原理）**。交换机作为汇聚中心，能将多台数据终端设备连接在一起，构成 **星状的网络**。

交换式局域网具有**独占**传输通道、**独享**信道带宽，**同时允许多对站点**进行通信、**系统带宽等于所有端口带宽之和**等特性。

#### 基本功能

- 建立和维护一个表示 **MAC 地址与交换机端口对应关系的交换表**。
- **在发送节点和接受节点之间建立一条虚拟连接** [即发送方所连的交换机端口（源端口）到接收方所连的交换机端口（目的端口）之间建立虚连接]。
- **完成数据帧的转发或过滤**。

### 交换表的内容

交换表主要包括**目的 MAC 地址**、与目的 MAC 地址**对应的交换机端口号**以及它**所属的虚拟子网**。其中，虚拟子网用 VLAN ID 标识。

#### 小型交换机的交换表（cisco-3XXX及以下型号）

交换机通过在超级用户模式下，**使用 show mac-address-talbe 命令查看**。

该交换表的第一列为目的MAC地址，第二列为地址类型，第三列为VLAN的ID号，第四号为该目的MAC地址所对应的交换机的端口号。

![小型交换机的交换报表](https://bluexiaowei.github.io/NCRE3/static/images/06-01.png)

#### 大型交换机的交换表（cisco-4000及以上型号）

交换机通过在超级用户模式下，**使用 show cam dynamic 命令查看**

第一列是VLAN的ID号，第二列是目的MAC地址，第三列是该地址相对应的交换机的端口号。 

![大型交换机的交换表](https://bluexiaowei.github.io/NCRE3/static/images/06-02.png)

### 交换机的交换结构

#### 软件执行交换结构

交换机接收到数据帧后，先将其由**串行代码转化为并行代码**，暂时存储在交换机的快速缓存RAM中，交换机的CPU开始根据数据帧中的目的MAC地址进行查询交换表。确定了目的端口后，交换机在源端口与目的端口之间建立起虚连接，然后将以并行代码形式存储在**RAM**中的数据帧**转化为串行代码**，发送到目的端口。上述的步骤都是**由软件控制完成**的。![image-20210320141519773](C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210320141519773.png) 

#### 矩阵交换结构

​    在矩阵交换结构中，交换机确定了目的端口后，根据源端口与目的端口打开**交换矩阵**中相应的开关，在两个端口之间建立连接，通过建立的这个传输通道来完成数据帧的传输。它的优点是交换速率快、时延小、易于实现；缺点是扩展与可管理性较差。![image-20210320141619667](C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210320141619667.png)

#### 总线交换结构

总线交换结构的交换机拥有一条很高带宽的背部总线。交换机的所有的端口都挂接在这条背部总线上，总线按时隙分为多条逻辑通道，各个端口都可以往该总线上发送数据帧，这些**数据帧都按时隙在总线上传输**，并从各自的目的端口中输出数据帧。总线交换结构对总线的带宽有较高的要求，**设交换机的端口数为M，每个端口的带宽为N，则总线的带宽应为M×N**。![image-20210320141728741](C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210320141728741.png)

#### 共享存储器交换结构

​    共享存储交换结构将**共享存储RAM**代替了总线交换结构中的总线，数据帧通过共享存储器实现从源端口直接传送到目的端口，它是总线交换结构的改进。

​    共享存储交换结构的优点是**结构简单、易于实现**；它的缺点是当交换机的端口数量不断增加，存储容量不断扩大的同时，数据交换的时延也会越来越大。而且共享存储交换结构的成本比较高。**适合小型交换机**采用。

![image-20210320141810557](C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210320141810557.png)



### 交换机的交换模式

#### 交换模式的分类

交换机的交换方式有 **静态交换和动态交换** 两种。静态交换时由人工完成端口之间传输通道的建立；**动态交换方式中依据目的 MAC 地址查询交换表，根据表中给出的输出端口来临时建立传输通道，这个传输通道在一个数据帧传送完成后自动断开**。

**交换机最常采用的交换方式时动态交换方式**。动态交换模式组要由存储转发和直通两种模式。而直通模式又有快速转发交换和碎片丢弃交换两种。

归纳起来，交换机主要有**快速转发**、**碎片丢弃**和**存储转发**三种交换模式。

##### 快速转发交换模式

**快速转发交换模式，也称作直通交换模式**，它是在交换机接收了帧的前 14 个字节，即 **接收到帧中 6 个 字节的目的地址后便理机转发数据帧**。该交换模式会在整个数据帧到之前就开始转发。

快速转发交换模式的优点在于端口交换时间短、延时小和交换速度快；缺点是不能进行检查纠错、速度匹配和流量控制，可靠性较差。因此它**适合小型交换机**。

##### 碎片丢弃交换模式

碎片丢弃交换模式也被称为无分段交换模式。**这种交换模式实在开始转发数据帧前，先过滤掉造成大部分数据报错误的冲突片。采用这种交换模式的交换机在转发数据时，先检查数据包的长度是否够 64 字节**。如果帧的长度小于 64， 则被视为碎片，交换机直接丢弃；而任何大于 64 字节的数据帧都被交换机视为有效帧，进行转发；碎片丢弃交换模式的优点是过滤掉了冲突碎片，提高了网络传输的效率和宽带的利用率。

##### 存储转发交换模式

存储转发交换模式 **将接收到的整个数据帧保存在缓冲区** 中，然后进行 **循环冗余码校验检查，在对错误数据帧进行处理后，才取出数据帧的目的地址，进行转发操作**。存储转发交换模式的不足之处在于其进行数据处理的**延时大**、交换速度相对较慢。但是它可以对数据帧进行链路差错校验，可靠性较高，能有效的改善网络性能；同时它可以**支持不同速率的端口**，保持高速端口与低速端口之间协同工作。

### 虚拟局域网技术

#### VLAN 的基本概念

虚拟网 VLAN 是以交换式网络为基础，把用户的终端设备划分为若干个逻辑工作组，每个逻辑工作组就是一个 VLAN。该逻辑组**都是一个独立的逻辑网段和广播域**。这个逻辑组的设定不受实际交换机区段的限制，也**不受用户所在的物理位置和物理网段的限制**。逻辑组的设定在交换机中是**通过软件完成**的。

#### VLAN 的特征

- VLAN 工作在 **数据链路层**，即 **OSI 参考模型的第二层**。
- VLAN 可隔离广播信息，每个 VLAN 为一个广播域，**VLAN 中的广播信息只能发送给这一个 VLAN 内部的成员，并不发送给其他 VLAN 成员**。
- 一个 VLAN 就是一个独立的逻辑网络，每个 VLAN 都具有唯一的子网号。**不同 VLAN 中的主机之间必须通过路由器或者三层交换机，才能实现相互通信**。

#### VLAN 的标识

VLAN 通常用 **VLAN ID （Vlan 号）和 VLAN name（Vlan 名）** 标识。

IEEE 802.1Q 协议规定，**VLAN ID 用 12 位（bit）表示**，可以支持 4096 个 VLAN。其中 **1 ~ 1005 是标准范围，1006 ~ 1024 为保留范围，1025 ~ 4096 是扩展范围**。但并不是所有交换机都能支持 4096 个 VLAN。

一部分交换机只支持标准范围 1 ~ 1005，其中能 **用与以太网的 VLAN ID 为 1 ~ 1000**, 而 **1002 ~ 1005 为 FDDI 和令牌环网使用的 VLAN ID**。

VLAN name 用 **32 个字符表示**，可以是**字母和数字**。若创建一个 VLAN 时，没有给定名字，则系统按默认方式，自动给出命名，**默认为 VLAN00xxx(xxx 即为该 VLAN 的 VLAN ID)**。

#### VLAN Trunk

​    VLAN Trunk（虚拟网中继）技术即是实现在多个交换机之间或是在交换机与路由器之间进行多个VLAN信息传输的技术。Trunk是一种**封装技术**，它是一条点到点的链路，主要功能就是仅通过一条链路就可以连接多个交换机从而扩展已配置的多个VLAN。

​    VLAN Trunk的标准机制是**帧标签**。帧标签卫每一个数据帧指定一个唯一的VLAN ID，这样即可表示该数据帧是属于哪一个VLAN的。

![image-20210320142738401](C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210320142738401.png)

​    在主干线路上要传输多个VLAN（VLAN1、VLAN2、VLAN3）的信息，则连接主干线路的两台交换机端口应具有Trunk功能。

#### 划分VLAN的方法

1.基于端口划分VLAN

​    由网络管理员根据交换机端口进行静态的VALN 分配，每个端口属于一个VLAN。当在交换机上将其某一个端口分配给一个VLAN 时，将一直保持不变直到网络管理员改变这种配置。

2.基于MAC地址

3.基于第三层协议类型或地址

​    按照网络层协议类型（TCP/IP、IPX、DECNET等）或按网络地址定义VLAN成员。

### 生成树协议STP

#### STP 的基本概念

- 生成树协议（STP）时一个 **二层链路管理协议**。它主要功能时在保证网络中没有回路的基础上，**允许在第二层链路中提供冗余路径**，以保证网络可靠、稳定的运行。
- **IEEE 802.1D 是最早的 STP 的标准**，它提供了动态冗余切换机制，是目前最为流行、应用最广泛的 STP 标准。
- **STP 运行在交换机和网桥设备上**，通过计算机建立一个稳定的树状结构网络，来避免网络中回路的产生。

#### STP 的工作原理

STP的工作过程：**通过在交换机之间传递网桥协议数据单元（BPDU），并运用生成树算法（STA）**对其进行比较计算。

- 首先进行根网桥选择（根网桥为整个生成树拓扑结构的核心，所有数据传输均通过根网桥）。
- 然后确定交换机冗余链路端口的工作状态，让一些端口进入**阻塞工作模式**，另一些端口进入转发工作模式。
- 其中设置为阻塞模式的端口不能进行数据流的转发和接收，但仍作为一个激活的端口，可进行 BPDU 的接收和读取。
- 如果**网络拓扑发生变化**或是生成树中的一个路径因故障而失效时，**生成树就会重新计算**，激活其他的备份链路，生成新的树拓扑，并强制将原来的故障链路变为备份链路，这时端口状态也会随之改变，以保证数据的传输路径是唯一的。
- **交换机与网桥在STP的工作过程中是有区别的**。交换机要对VLAN进行处理，它指定一个根交换机，并为每一个VLAN选择一个根网络，然后再确定各个冗余端口的阻塞或转发状态，保证唯一的传输路径，并将其他的冗余链路作为备份链路，生成无回路的拓扑结构。

#### BPDU 相关内容

BPDU 中携带了实现生成树算法的有关信息，包括：**Root Id、Root Path Cost、Bridge ID、Port ID、Hello time、Max Age**；

- BPDU 数据包有两种类型，一种是包含 **配置信息的配置 BPDU（不超过 35 个字节）**，另一种包含 **拓扑变化信息的拓扑变化通知 BPDU （不超过 4 个字节）**。
- 在配置 BPDU 包的 Bride ID 信息，是选取根网桥或根交换机的主要依据；
- 一般情况下，Bridge ID 值最小的成为根网桥或根交换机；
- Bridge ID 用 8 个字节表示，后 6 个字节为交换机的 MAC 地址，前 2 个字节为优先级值；
- 优先级值越小，优先级越高（根网桥或根交换机）；
- **优先级取值范围 0 ~ 61440， 增质量为 4096， 交换机的优先级一般默认为 32768**，可以使用命令人工设置；
- 一台交换机的优先级设置 8189，优先级高级其他交换机，会成为根交换机；
- 选择根网桥时，优先级相同，会根据 MAC 地址的值决定根网桥，**MAC 的值最小的为根网桥**；
- 默认情况下，交换机 **每 2 秒定时发送一次 BPDU**，当检测到网络拓扑变化或故障发生时，也会发送新的 BPDU，以及时进行生成树的更新。

### 交换机的配置

#### 交换机的配置方式

##### 使用Console端口配置

使用控制（**Console**）端口配置交换机，常用于交换机刚出厂并进行第一次配置时所采用的模式；

Console是一个用来连接配置终端的异步串行口，接口标准为**RJ-45**。是交换机刚出厂时，第一次对其进行配置所用的方法。 使用Console端口配置交换机时，需要准备一台已经安装了超级终端软件的计算机作为配置终端，同时还需要一条由厂家提供的RJ-45到9针或25针异步串行接口的信号电缆。使用超级终端软件对异步串行口进行参数配置：**传输速率9600**，**数据位8位**，**停止位1位**。

##### 使用telnet命令配置

使用 **Telnet** 配置交换机，常用于远程配置模式，该模式要求交换机已经连接到网上，而且已配置了交换机的设备管理地址

##### 使用浏览器配置交换机

使用浏览器（**IE**）配置交换机，主要用于交换机被设置成 WEB 服务器，然后通过网络上的任意一个终端站点使用浏览器对交换机进行配置。

具体步骤：

1. 交换机的配置

2. 启用交换机的HTTP Server

   CatOS:    Catalyst6500> (enable)  set ip http server enable

   Cisco IOS:  switch-3548(config)#ip http server

3. 配置HTTP用户认证方式:   enable、 local、tacacs

4. 下载并安装Jave-plugin插件。

5. 使用Web浏览器监控和配置交换机

#### 配置交换机的系统信息

##### 配置交换机的主机名

①Cisco IOS:  

switch-3548(config)#hostname switch-PHY-3548

switch-PHY-3548(config) #

②CatOS: 

CatOS6500**>** (enable) set system name switch-PHY-6500

 System name set.  

switch-PHY-6500 **>** (enable) 

##### 配置超级用户口令

①Cisco IOS:  

switch-3548(config)# enable password zzz(明文)

switch-3548(config)# enable password 7 zzz(加密)

switch-3548(config)# enable secret 5 zzz(加密)

②CatOS: 

CatOS6500> (enable) set enablepass
 Enter old password:  
 Enter new password:
 Retype new password:
 Password changed.

##### 设置远程登录口令

①Cisco IOS:  

switch-3548 (config)#line vty 0 4
 switch-3548 (config-line)# password 0 zzz (明文) 
 switch-3548 (config-line)# password 7 zzz (加密) 
 switch-3548 (config-line)#

②CatOS: 

CatOS6500> (enable) set password 
 Enter old password:  
 Enter new password:
 Retype new password:

- 交换机的基本配置一般都是用过 **使用 Console 端口配置方式** 完成，配置的主要内容哟配置交换机的主机名、超级用户口令、设备管理地址和远程登录口令；
- 关于交换机配置命令语句，主要时以 Cisco IOS（35 系类）和 Catalyst OS（65 系列）两种交换机操作系统来讲解；
- 那么常考的配置命令语句有 **设置系统时间、配置设备管理 IP 地址**；

#### 交换机端口配置

- 35 系列
  - 设置时间：`clock set HH:mm:ss DD MM YYYY`
  - 配置 IP：`ip address <IP 地址> <子网掩码>`
  - 缺省路由：`ip default-gateway <缺省路由 IP 地址>`
  - VLAN1 时用于设备管理的缺省 VLAN
  - 配置端口描述信息：
    1. `(config)# interface f0/1` (进入端口配置模式)
    2. `(config-if)# description To-Webserver`（配置端口描述信息）
    3. `(config-if)# shutdown`（关闭端口）
    4. `(config-if)# no shutdown`（开启端口）
    5. `(config-if)# duplex auto`（设置为自动协商，默认）
    6. `(config-if)# duplex full` （设置为全双工）
    7. `(config-if)# duplex half` （设置为半双工）
    8. `(config-if)# speed auto` （自动速率）
    9. `(config-if)# speed 10` （设置速率 10Mbit/s）
- 65 系类
  - 设置时间：`set time ww MM/DD/YYYY HH:mm:ss`
  - 配置 IP：`set interface sc0 <IP 地址> <子网掩码> <直接广播地址>`
  - 缺省路由：`set ip route 0.0.0.0 <缺省路由 IP 地址>`
  - 配置端口描述信息：
    1. `(enable) set port name <mod/port> <name>` （name 为端口描述，一般不超过 240 个）
    2. `(enable) set port disable <mod/port>` （开启端口）
    3. `(enable) set port enable <mod/port>` （关闭端口）
    4. `(enable) set port duplex <mod/port> full` （全双工）
    5. `(enable) set port duplex <mod/port> half` （半双工）
    6. `(enable) set prot speed <mod/port> auto` （自动速率）
    7. `(enable) set prot speed 10` （设置速率 10Mbit/s）

### 交换机 VLAN 的配置

交换机 VLAN 的配置主要任务是：配置 VTP、建立或删除 VLAN、为交换机端口分配 VLAN 和在交换机端口上配置 VLAN Trunk。

#### VLAN 配置

- 35 系列
  - 进入 链接：`Switch-3528-TEST> # vlan data`
  - 建立 VLAN： `(vlan) vlan <vlan_ID> name <vlan_name>`
  - 删除 VLAN: `(vlan) no vlan <vlan_ID>`
  - 修改 VLAN： `(vlan) vlan <vlan_ID> name <vlan_name>`
- 65 系列
  - 进入：`Switch-6509-TEST> # enable`
  - 建立 VLAN: `(enable) set vlan <vlan_ID> name <vlan_name>`
  - 删除 VLAN: `(enable) clear vlan <vlan_ID>`
  - 修改 VLAN: `(enable) set vlan <vlan_ID> name <vlan_name>`

#### VLAN Trunk 的配置

- 35 系类
  - 进入交换机端口配置模式：
    1. `Switch-3528-TEST> # configure terminal`
    2. `(config) # int fo/24`
    3. `(config-if) #`
    
  - 配置 VLAN Trunk 模式：`(config-if)# switchport mode trunk`
  
  - 封装 VLAN 协议
  
    **Cisco ISL：思科私有协议。**
  
    **IEEE 802.1Q：俗称“Dot One Q”(dot1q),国际标准。**
  
    **IEEE 802.1Q可用于不同厂家的交换设备互连，且双方交换机端口上都要封装dot1q协议**，保证协议的一致性，否则不能正确的传输多个VLAN信息。
  
    1. `(conifg-if)# switchport trunk encapsulation dotl q` (202.1q 模式)
    2. `(conifg-if)# switchport trunk encapsulation isl` (ISL 协议)
    3. `(config-if)# switchport trunk encapsulation negotiate P` (自动协商)
  
  - 设置允许中继的 VLAN: `(config-if)# switchport trunk allowed vlan` 1,10 | 11-20
  
  - 设置不允许中继的 VLAN: `(config-if)# switchport trunk allowed vlan except` 1,10 | 11-20
- 65 系列
  - 配置 VLAN Trunk 模式，分装 VLAN 协议：`(enable) set trunk <mod/port> <mode> <type>`
  - 设置允许中继的 VLAN：`(enable) set trunk <mod/port> vlan <vlan_ID>`
  - 设置不允许中继的 VLAN：`(enable) clear trunk <mod/port> <vlan_ID>`

#### 交换机 VTP 的配置

VTP 是 VLAN 中继协议，也被称为 VALN 干道协议。他是一个 OSI 参考模型第二层的通信协议，主要用于管理在同一个域的网络范围内 VLANs 的建立 删除和命名

配置 VTP 的任务主要有两个：一是 **建立 VTP 域**，二是 **设置 VTP 的工作模式**；

**注意：** 同一个域的所有交换机，必须运行同版本的 VTP，并具有相同的域名；

- VTP Server：一般，一个 VTP 域内的整个网络只设置一个 VTP Server, 它 **维护该 VTP 域中所有 VLAN 信息列表，可以建立、删除或修改 VLAN**
- VTP Client：也维护所有 VLAN 信息列表，但是它的VLAN 信息是从 VTP Server 学习到的，并且**不具有建立、删除或修改 VLAN 的功能**。
- VTP Transparent：相当于一个独立的交换机，它不参与 VTP 工作，不从 VTP Server 学习 VLAN 的配置信息，二只拥有本设备上自己的 VLAN 信息，因此它也 **只能建立、删除和修改本机上的 VLAN 信息**。
- 35 系列
  - 进入工作模式：`Switch-3528-TEST> # configure terminal`
  - 域名配置：`(config)# vtp domain TEST`
  - 工作模式：`(config)# vtp mode <type>` type="server|client|transparent"
- 65 系列
  - 域名配置：`(enable)# set vtp domain TEST`
  - 工作模式：`(enable)# set vtp mode <type>` type="server|client|transparent"

### 为交换机分配端口

- 35 系列
  - 进入端口配置模式：同上 `交换机 VLAN 的配置 > 3 > 35 系列`
  - 端口 VLAN 分配：`(config-if) switchport access vlan <vlan_ID>`
- 65 系列
  - 端口 VLAN 分配：`(enable) set vlan <vlan_ID> <mod/port>`

### 交换机 STP 的配置

#### 打开或关闭STP

- 35系列

  switch-3548# configure terminal 

  switch-3548 (config)# spanning-tree vlan 3   

  switch-3548 (config)# no spanning-tree vlan 3 

- 65系列

  CatOS6500> (enable) set spanning-tree enable 3 

  CatOS6500> (enable) set spanning-tree disable 3

#### 配置根网桥和备份根网桥

- 35系列

  switch-3548 (config)# spanning-tree vlan 3 root primary

  switch-3548 (config)# spanning-tree vlan 3 root secondary 

- 65系列

  CatOS6500> (enable) set spanning-tree root 1,200-204

  CatOS6500> (enable) set spanning-tree secondary 1,200-204

#### 配置生成树优先级

配置生成树优先级：生成树优先级的取值范围是0~61440，增量是**4096**。优先级的值越小优先级越高，如果优先级为0是最高优先级，61440优先级最低。

- 35 系列
  - 优先级配置：`(config)# spanning-tree vlan <vlans> prioriy <0-61440>`
- 65 系列
  - 优先级配置：`(enable)# set spanning prioriy <0-61440>`

#### 配置生成树可选功能

- BackboneFast：是 **阻塞端口不在等待这段时间**，而是 **直接将端口有侦听和学习状态换为转发状态**；
- UplinkGast：当生成树拓扑结构发生变化和在使用上链路组的冗余链路之间完成负载平衡，**提供快速收敛**；
- PortFast：用于在接入层交换机端口上跳过正常的生成树操作，**加快终端工作站接入网络中的速度**。它的功能是使交换机的端口侦听和学习转台，**直接从阻塞状态进入到转发状态**；
- BPDU Filtering：会是交换机在指定的端口上停止发送 BPDUs，对于进入这个端口的 BPDUs 也不做任何处理，同时 **立刻就昂端口转台转换为转发状态**；
- 35 系列：
  - BackboneFast:`(config)# spanning-tree BackboneFast`
  - UplinkFast：`(config)# spanning-tree uplinkfast`
  - PortFast：`(config)# spanning-tree portfast defalut`
  - BPDU Filtering：`(config)# spanning-tree portfast bpdufilter default`
- 65 系列：
  - BackboneFast:
    1. `(enable)# set spantree backbonefast enable`
    2. `(enable)# set spantree backbonefast disable`
  - UplinkFast：
    1. `(enable)# set spantree uplinkfast enable`
    2. `(enable)# set spantree uplinkfast disable`
  - PortFast：
    1. `(enable)# set spantree portfast <mod/port> enable`
    2. `(enable)# set spantree portfast <mod/port> disable`
    3. `(enable)# set spantree portfast <mod/port> default`
  - BPDU Filtering：
    1. `(enable)# set spantree portfast bpdu-filter enable`
    2. `(enable)# set spantree portfast bpdu-filter disable`
    3. `(enable)# set spantree portfast bpdu-filter <mod/port> enable`
    4. `(enable)# set spantree portfast bpdu-filter <mod/port> disable`
    5. `(enable)# set spantree portfast bpdu-filter <mod/port> default`

## 路由器及其配置

### 路由器基础与基本命令

#### 路由器概述

路由器是工作在**网络层**的设备。路由器负责将数据分组从源端主机经**最佳路径**传送到目的端主机。路由器主要用于同类或异类局域网以及局域网与广域网之间的互联。是连接不同逻辑子网的网络互连设备。

路由器具有异构网络互连、广域网互连、和**隔离广播信息**的能力。

#### 路由器的基本功能

1. 路由选择

​    路由选择就是路由器依据目的IP地址的网络地址部分，通过路由选择算法确定一条从源结点到达目的结点最佳路由。

​    路由器通过路由协议、网络连接的情况及网络的性能来建立网络的拓结构。路由算法为网络上的路由产生一个权值，路由器通过权值来选择最佳路由，权值越小，路由越佳。 

   2.**分组转发**

​    对于一台路由器，其分组转发的任务即是在收到数据包后，根据**路由表**所提供的最佳路径的信息，将其转发给下一跳的路由器、目的端口或是缺省路由器。

​    缺省路由也称为缺省网关，它是与主机在同一个子网中的路由器端口的IP地址。

​    路由器也有它的缺省网关。如果目标网络没有直接显示在路由表里的时候，那么就将数据分组传送给缺省网关。它一般指向与该路由器的一个端口的直接相连接的，并且通往Internet的出口路由器。

**分组转发的思想：**

​	**目的IP地址，全程不变。**

​	**目的MAC地址，逐跳修改。**

#### 路由表

路由器通过对路由表的查询来选择最佳路径的策略，路由表中保存着各种传输路径的相关数据，供路由选择时使用。

路由表的内容主要包括：

①目的网络地址及其所对应的目的端口

②下一跳路由器的名字

③缺省路由的信息。

​    路由表可以是由系统管理员固定设置好的，也可以由系统动态修改，可以由路由器自动调整，也可以由主机控制。

#### 路由表实例一 （cisco12000上的路由表）

C   212.112.7.0/24 is directly connected, FastEthernet2/5

​       212.112.37.0/30 is subnetted, 1 subnets
 C   212.112.37.16/24 is directly connected, POS3/0

S   167.105.125.128 [1/0] via 202.112.7.1

S*   0.0.0.0/0 [1/0] via 202.112.41.217

![image-20210321100110936](C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210321100110936.png)

##### 路由表项讨论

①路由源码

“C”: 直连，“S”: 静态，“I” : IGRP，“O”: OSPF，“R”: RIP，“i”: IS-IS，“B”: BGP，“E”: EGP

②第2列是目的网络地址和掩码

③第3列是目的端口或下一跳路由器地址

- 如果是直连，则这个字段为给出的目的端口
- 如果有下一跳路由器，则为下一跳路由器的IP地址

④缺省路由的路由表项

   网络地址和掩码全是0

#### 路由表实例二 （三层交换机上的路由表）

O   222.29.2.0/24 [110/3] via 162.105.1.145,00:13:43,vlan1

O   222.29.32.0/24 [110/3] via 162.105.1.145,00:13:43,vlan1

202.37.140.0/24 is variably subnetted, 3 subnets,2 masks

OE2   202.37.140.40/289 [110/20] via 162.105.1.145,00:13:43,Vlan1

OE1  202.37.140.0/28 [110/22] via 162.105.1.145,00:13:43,Vlan1

第2列表示路由类型：

- E1 OSPF外部路由类型1
- E2 OSPF外部路由类型2

第4列，如【110/22】：

**110是管理距离，22是权值（metric）或成本**

**管理距离**用于衡量路由表中给定的路由信息源的“**可信度**”。 

| 路由协议  | 管理距离 | 路由协议  | 管理距离 |
| --------- | -------- | --------- | -------- |
| 直接连接  | 0        | 静态路由  | 1        |
| 外部BGP   | 20       | 内部EIGRP | 90       |
| IGRP      | 100      | OSPF      | 110      |
| IS-IS     | 115      | RIP       | 120      |
| 外部EIGRP | 170      | 内部BGP   | 200      |
| 未知      | 255      |           |          |

权值是路由器通过路径选择算法为网络上的路径产生的一个数字。路由器根据这个值确定最佳路径。

路由器常用的权值： （了解）

①带宽：链路的数据能力

②延迟：数据包从源送到目的所需的时间

③负载：链路上的活动数量

④可靠性：链路的差错率

⑤跳数：通过路由器的数量

⑥滴答数：用IBM PC的时钟滴答计数延迟。

⑦花费：cost，一般由管理员指定。

#### 路由器的结构

![image-20210321115048654](C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210321115048654.png)

##### 中央处理器

​    CPU是路由器的处理中心，CPU负责实现路由协议、路径选择计算、交换路由信息、查找路由表、分发路由表和维护各种表格，以及转发数据包等功能。CPU的处理能力直接影响路由表查找事件、吞吐量和路由器的性能。

##### 内存

①只读内存（Read Only Memory，ROM） 

​    ROM中包括开机开机诊断程序、引导程序和操作系统软件。不能修改其中保存的内容。 

②随机存储器（RAM）

​    RAM是可读可写存储器。用来存储用户的数据包队列以及路由器在运行过程中产生的**中间数据**，如路由表、ARP缓冲区等。此外，RAM还用来存储路由器的运行配置文件。当**路由器被关闭或重新启动时，RAM中的内容都将丢失**。

③非易失性随机存储器（NVRAM）

​    NVRAM是可读可写存储器。是用来**存储路由器的启动配置文件**。在路由器断电时，其内容仍能保持。

④闪存（FLASH）

​    是可擦写的ROM。它主要负责**保存操作系统的映像文件和一些微代码**。在路由器断电时，其内容仍能保持。

#### 路由器的工作模式

一、用户模式（User EXEC）

​    当通过控制台或Telnet成功登录到路由器后，将会看到。它是一种只读模式，用户可以浏览关于路由器的某些信息，但不能进行任何修改。

​    该模式默认的提示符为：`router>`

二、特权模式（Priviledged EXEC）

​    在用户EXEC模式提示符后键入enable命令并按提示输入使能口令后将进入特权模式。可以管理系统时钟、进行错误检测、查看和保存配置文件、清楚闪存、处理并完成路由器的冷启动等操作。该模式不能对端口及网络协议进行配置。

​    该模式默认的提示符为：`router#`

三、全局配置模式（Global Configuration）

​    在特权EXEC模式下，通过键入`configure terminal`命令可以进入。全局配置模式用于配置路由器的全局性的参数（主机名、口令、TFTP服务器、静态路由、访问控制列表等），更改已有配置等。

   全局配置模式的默认提示符为:`router(config)#`

四、其他配置模式

包括接口配置模式、虚拟终端配置模式、路由配置模式等。

接口配置模式：`router (config)#interface f0/12`

​          				 `router（config-if）#`

虚拟终端配置模式：`router (config)#line vty 0 15`

​            					  `router（config-line）#`

路由配置模式：`router (config)#router rip`

​                           `router（config-router）#`

五、设置模式（Setup）

​    当通过console端口进入一台刚出场的没有任何配置的路由器启动时会进入设置模式。系统以对话框提示用户设置路由器，协助用户建立第一次的配置文件。

六、RXBOOT模式

​    RXBOOT模式是路由器的维护模式。在密码丢失时，可以进入RXBOOT模式，以**恢复密码**。

#### 路由器的基本操作与配置方法

一、路由器的配置方式

**AUX**，通过**远程拨号配置**路由器

二、使用控制端口(Console)配置路由器

三、使用telnet配置路由器

1.必备条件

①作为模拟终端的计算机与路由器都必须与网络连通，它们之间能够相互通信。

②计算机必须有访问路由器的权限。

③路由器必须预先配置好远程登录的密码

2.路由器的配置（08下）

router (config)#line vty 0 15

router（config-line）#password 7 zzz307

3.远程登录的具体步骤

进入“运行串口”，输入“telnet 202.112.7.4”

四、使用TFTP配置路由器（了解）

1.在网络上必须配备一台计算机作为TFTP server,且必须安装并运行TFTP server软件。

2.路由器的操作步骤

①拷贝配置文件到TFTP server。

Router#write network

Remote host [ ]? 202.105.130.120  

Name of configuration file to write [router-config]?   

Write file router-config on host 202.105.130.120 ? [confirm] 

\################

Writing router-config ……

### 路由器的基本配置及其公用命令

一、路由器的基本配置

1、配置主机名

Router（config）#hostname router-phy

2、配置超级用户口令

Router（config）#enable secret phy123

Router（config）#enable password 7 phy123

3、配置系统时钟。

Router# calendar set hh:mm:ss <1 -31> MONTH <1993-2035>

如：Router# calendar set 10:24:00 22 march 2007

二、几个公用命令

1. 退出命令（exit）

   Router（config-if）#exit

   Router（config）#exit

   Router#

   Router（config-if）#end

   Router#

2. 保存配置

   **Router# write memory （保存到路由器的NVRAM中）**

   Router# write network tftp （保存到TFTP服务器中）

3. 删除配置

   Router# write erase

4. 网络的基本检测命令

   ① telnet 　　

   Router> telnet paris (或IP地址)

   ② ping 　　

   ③ trace 　　　　

   ④ show命令 　　

   Router>show flash

   Router>show clock

   Router>show version

   Router>show configuration

   **Router# show ip route   注意模式与命令的拼写**

   Router# show ip protocols

### 接口配置、 Pos接口配置

一、路由器接口的基本配置 

1、配置接口描述信息

Router（config）#int g6/0

Router（config-if）#description to-beijing 

2、配置接口带宽

Router（config）#int POS3/0

Router（config-if）#**bandwidth 2500000** (设置接口带宽为2.5Gbps)

3、配置接口的IP地址

Router（config-if）#ip add 202.112.7.249 255.255.255.252

4、接口的开启与关闭

Router（config-if）#shutdown

Router（config-if）#no shutdown

二、 局域网接口配置

1、配置标准以太网接口（Ethernet）

Router（config）# interface Ethernet0 

Router（config-if）# description TO Beijing 

Router（config-if）# ip address 202.112.7.4 255.255.255.0 

Router（config-if）# bandwidth 10000 

Router（config-if）# no shutdown 

Router（config-if）# exit

2、配置快速以太网接口（Fast Ethernet)

Router（config）# interface f2/1 

Router（config-if）# description TO BEIJING 

Router（config-if）# ip address 202.111.41.145.255.255.255.240 

Router（config-if）# bandwidth 100000

Router（config-if）# duplex full 

Router（config-if）# no ip directed-broadcast 

Router（config-if）# no ip proxy-arp 

Router（config-if）# no shutdown 

Router（config-if）# exit 

三、广域网接口配置

1、配置异步串行口(用于连接modem，为用户提供**拨号上网服务**)

Router（config）# interface a1（异步口，以a开头）

Router（config-if）# ip unnumbered ethernet0 

Router（config-if）# Encapsulation ppp （**不能封装为HDLC**）

Router（config-if）# Async default ip address 202.112.7.129 

Router（config-if）# Async dynamic routing 

Router（config-if）# Async mode interactive 

Router（config-if）# no shutdown 

Router（config-if）# Exit 

2、**配置同步串行口**

​    高速同步串行接口类型是Serial，可简写为s。它主要用于**DDN专线、帧中继、卫星、微波等广域网连接**。需要配置的参数主要有接口带宽、接口协议和接口的IP地址

Router（config）# Interface s1/1 （同步口，以s开头）

Router（config-if）# Description TOBEIJING 

Router（config-if）# Bandwidth **2048** （带宽为2M）

Router（config-if）# Ip address 212.112.41.81 255.255.255.252 

Router（config-if）# Encapsulation hdlc （**封装HDLC或PPP协议，HDLC为缺省**）

Router（config-if）# No ip directed-broadcast 

Router（config-if）# No ip proxy-arp 

Router（config-if）# No shutdown 

Router（config-if）# Exit 

3、**配置POS接口**（综合题）

Router（config）# Interface POS3/0 

Router（config-if）# Description TO BEIJING 

Router（config-if）# **Bandwidth 2500000** （单位是Kbps）

Router（config-if）# Ip address 212.14.37.18 255.255.255.252 

**Router（config-if）#** **Crc 32 （可选的CRC校验位是16和32）**

**Router（config-if）# Pos framing sdh （可选帧格式是SDH和SONET）**

Router（config-if）# No ip directed-broadcast 

**Router（config-if）# Pos flag sls0 2** 

  **（sls0=00表示是SONET帧数据，sls0＝10（十进制2）表示是SDH帧）**

4、loopback接口配置

​    loopback接口没有一个实际的物理接口与之相对应，也没有与其他网络节点相连接的物理链路。它是一个**虚拟的接口**，loopback接口号的有效值为**0~2147483647**。主要作用是他作为一台路由器的管理地址，使网络管理员可以随时登录到路由器上，对路由器进行配置管理。它还可以作为动态路由协议ospf和bgp的router id ，使路由器功能更加稳定可靠。每台路由器上都配置一个环回接口，它**永远处于激活状态**。网络管理员为loopback接口分配一个IP地址作为管理地址，其**掩码应为255.255.255.255**。

Router（config）# Int loopback 0 

Router（config-if）# Ip address 192.168.1.1 255.255.255.255 （掩码一定为255.255.255.255）

Router（config-if）# No ip route-cache 

Router（config-if）# No ip mroute-cache 

### 访问控制列表

#### IP访问控制列表功能简介

1. IP访问控制列表的主要功能

   通过灵活地增加访问控制列表，ACL可以当作一种网络控制的有力工具，用来过滤流入和流出路由器接口的数据包。

2. IP访问控制列表的过滤准则

   ①过滤源地址或目的地址

   ②过滤端口号

   过滤协议（ICMP、TCP、UDP）

   3.访问控制列表的分类

​     ①标准访问控制列表：只能检查数据包的**源地址**。表号的范围是：**1-99**，**扩展后是1300-1999**

​     ②扩展访问控制列表：检查数据包的**源地址与目的地址**。根据源网络，目的网络，子网掩码，主机的ip地址决定数据包的过滤。该列表还可以检查指定的**协议**以及**端口号**。表号范围是**100-199**，**扩展后是2000-2699**

#### 配置IP访问控制列表

首先在全局配置模式下定义访问列表，然后将其应用到接口中，使通过该接口的数据包需要进行相应的匹配，然后决定被通过还是拒绝。并且访问列表语句按顺序自上向下开始匹配数据 包。如果一个数据包头与访问权限表的某一语句不匹配，则继续检测列表中的下一个语句。在执行到访问列表的最后，还没有与其相匹配的语句，数据包将被隐含的“拒绝”语句所拒绝。

​    ACL语句的顺序非常重要。若要允许除202.204.4.2意外的所有源地址通过路由器，需要先配置“deny 202.202.4.2”再配置“permit any”

1.配置访问控制列表的两个重要参数

①表号和名字

​    表号是用来标识或是引用某个访问控制列表。访问控制列名的名字用字符串来表示。

②通配符掩码

​    访问控制列表的通配符掩码是一个32bit的数字字符串，它点分成4个8位，每组包含8bit。在通配符掩码位中，表示形式与IP地址的子网掩码相同。它实际上即是**子网掩码的反码**。

2.**配置IP访问控制列表**

①**配置标准访问控制列表**

在全局模式下，命令格式：

access-list access-list-number {permit | deny} source wildcard-mask

②配置扩展访问控制列表

（1）使用access-list命令。

在全局配置模式下：

命令格式：access-list access-list-number {permit | deny} protocol source wildcard-mask destination wildcard-mask [operator] [operand]

其中：operator(操作)，操作有“lt"（小于）、“gt”（大于）、“eq”（等于）、“neq”(不等于)。

operatand（操作数），指的是端口号。

（2）使用ip access-list命令

在全局配置模式下：

命令格式：ip access-list extended | standard access-list-number | name

在扩展或标准访问控制列表模式下(如：Router(config-ext-nacl)#)，配置过滤规则：

命令格式：permit | deny protocol source wildcard-mask destination wildcard-mask [operator] [operand]

（3）用名字标识访问控制列表的配置方法

在全局配置模式下：

命令格式：ip access-list extended | standard access-list-number | name

在扩展或标准访问控制列表模式下（如：Router(config-ext-nacl)#）,配置过滤准则：

命令格式：permit|deny protocol source wildcard-mask destination wildcard-mask [operator] [operand]

### 静态路由、 动态路由的配置

#### 路由器的静态路由配置

一、静态路由的配置方法

Router（config）# **ip route** <**目的网络地址**><**子网掩码**><**下一跳路由器的IP地址**> 

如：Router（config）# ip route 59.65.96.0 255.255.240.0 222.112.37.1

二、静态默认路由的配置方法

​    默认路由指路由器对接收的数据包找不到匹配路由表项时，如果路由表中有默认路由，路由器按默认路由的下一跳地址转发数据包。

Router（config）# ip route **0.0.0.0 0.0.0.0** <下一跳路由器的IP地址>

#### 动态路由协议的配置

##### RIP动态路由协议的配置

   RIP路由协议只一句路由器**跳数**（hop数）决定最佳路径，不考虑带宽、延时和其他因素。具有**最小跳数值的路径为”最优”路径**。RIP限制最大跳数为**15**，如果为16，意味着路径不可达。另外，RIP在路由更新报文中部携带子网掩码信息，不支持VLSM。RIP定时更新路由周期为30秒。

​    RIP有两个版本：v1和v2。版本2提供了VLSM，多点广播路由更新和路由更新认证等新功能。

1、**RIP的基本配置**

Router(config)#router rip

Router(config-router)#network 159.105.0.0

Router(config-router)#network 212.112.7.0（网络地址写类地址，主机号都为0）

2、RIP的高级配置

①配置被动接口

Router(config)#router rip 

Router(config-router)#passive-interface ethernet 0

②**配置路由过滤**

Router(config)#access-list 12 deny any

Router(config)#router rip

Router(config-router)#distribute-list 12 in ethernet0

③配置管理距离

Router(config)#router rip 

Router(config-router)#distance 50

④定义邻居路由器

Router(config)#router rip 

Router(config-router)#neighbor 202.112.7.2

##### OSPF动态路由协议的配置

1.OSPF的基本配置

1) 使用network命令定义参与OSPF的子网地址

①配置单个IP地址参与OSPF 

Router (config) # router ospf 63 （进程号）

Router (config-router) # **network** 131.107.25.1 **0.0.0.0**（反掩码） area 0 

②网络地址参与OSPF 

Router (config-router) # network 133.181.0.0 **0.0.255.255** area 0 

2) 定义参与OSPF的子网地址

Router (config-router) # **area** 0 range 212.37.123.0 **255.255.255.0** （正掩码）

2.几个常用OSPF参数的配置（了解）

1) 配置被动接口(包括路由器和第三层交换机的配置) 

Router (config-router) # passive-interface Ethernet 0 

Router (config-router) # passive-interface vlan37 

2) 配置路由过滤

Router (config) # access-list 12 deny any 

Router (config) # router ospf 63 

Router (config-router) # distribute-list 12 in serial 0 

3) 配置管理距离

Router (config-router) # distance 10 

4)配置引入外部路由到OSPF的参数

①配置OSPF引入外部路由的花费值

Router (config-router) # redistribute metric 100 

②配置引入外部路由时缺省的标记值

Router (config-router) # redistribute tag 10 

③配置引入外部路由时缺省的外部路由类型

Router (config-router) # redistribute connected metric-type 1 subnets 

### 路由器的DHCP配置

​    IP地址分配有**静态分配**和**动态分配**两种分配方式。动态分配是使用动**态主机配置协议（DHCP）**，由网络站点提出DHCP请求，从DHCP服务器上自动获取一个IP地址与缺省网关、域名及域名服务器的IP地址等相关的TCP/IP属性的信息

1. 配置IP地址池的名称，并进入DHCP Pool配置模式

   Router (config) # ip dhcp pool ttt 

2. 配置IP地址池的子网地址和子网掩码

   ①在DHCP Pool配置模式下：

   命令格式：network <network-number> [mask | /prefix-length]

   Router(dhcp-config)#network 201.23.98.0 255.255.255.0

   Router(dhcp-config)#network 201.23.98.0/24

   ②配置不用于动态分配的IP地址（除外地址）

   命令格式：ip dhcp excluded-address low-address [high-address]

   - 排除从201.23.98.2到201.23.98.10的一段IP地址

     Router(config)#ip dhcp excluded-address 201.23.98.2 201.23.98.10

   - 排除单个IP地址201.23.98.193

     Router(config)#ip dhcp excluded-address 201.23.98.193

   3.配置IP地址池的缺省网关

​        命令格式：default-router address [address2 ... address8]

​        Router(dhcp-config)#default-router 201.23.98.1

4.配置IP地址池的域名系统

①配置IP地址池的域名

在DHCP Pool配置模式下：

命令格式：domain-name <name>

Router(dhcp-config)#domain-name pku.edu.cn

②配置IP地址池的域名服务器的IP地址

在DHCP Pool配置模式下：

命令格式：dns-server address [address2 ... address8]

Router(dhcp-config)#dns-server address 212.105.129.27 212.105.129.26

5.配置IP地址池的地址租约时间

在DHCP Pool配置模式下： （注意单位）

命令格式：lease {days [hours][minutes]|infinite}

例：设置租约时间为5小时

Router(dhcp-config)#lease 0 5

6.取消地址冲突记录日志

在全局配置模式下：

Router(config)#no ip dhcp conflict logging

一个完整的DHCP配置信息：

no ip dhcp conflict logging

ip dhcp exeluded-address 182.105.246.2 182.105.246.10

ip dhcp exeluded-address 182.105.247.200 182.105.247.254 
 ip dhcp pool 246

network 182.105.246.0 255.255.255.0
 default-router 182.105.246.1
 domain-name pku.edu.cn
 dns-server 182.105.129.26 182.105.129.27 222.112.7.13
 lease 0 5

ip dhcp pool 247

## 无线局域网设备安装与调试

### 蓝牙技术与标准

#### 蓝牙技术的基本概念

​    蓝牙技术是一种支持设备短距离通信的无线电技术，它的通信距离一般为**10m**以内。蓝牙技术能在包括移动电话、PDA、无线耳机、笔记本电脑、相关外设等众多设备之间进行无线信息交换。蓝牙技术的标准是**IEEE802.15**，工作在**2.4GHz** 频带，带宽为**1Mb/s**。

​    蓝牙技术是由东芝、爱立信、IBM、Intel和诺基亚于1998年5月共同提出的近距离无线数字通信的技术标准。

#### 蓝牙系统的主要参数和技术指标

1. 工作频段：**ISM频段2.402GHz-2.480GHz**

2. 双工方式：**TDD** 

3. 业务类别：**同时支持电路交换及分组交换业务。**

4. 标称数据速率：**1 Mbps** 

5. 异步信道速率：**非对称连接 723.2kbps/57.6kbps。对称连接433.9kbps（全双工模式）**

6. 同步信道速率：**64kbps** 

7. 信道间隔：1 MHz。 

8. 信道数：79 

9. 发射功率级范围：**0dBm（1 mW），覆盖1-10m，20dBm（100mW），覆盖扩展至100m**。

10. 跳频频点数：79个频点/MHz （2402+k（MHz），k=0,1,2…78）。 

11. 跳频速率：1600次/s 

12. 工作模式：Active/Sniff/Hold/Pack 

13. 数据连接方式：面向连接业务SCO、无连接业务ACL。 

14. 纠错方式：1/3FEC，2/3FEC,CRC16,ARQ。 

15. 鉴权：反映逻辑算术方式。 

16. 密钥：以8bit为单位增减，**最长128bit**。 

17. 安全机制：链路级，认真基于共享链路密钥询问/相应机制，认证和加密密钥生成基于 SAFER+算法。 

18. 话音编码方式：CVSD或对数PCM。 

19. 网络拓扑结构：AD hoc、Piconet及Scatternet结构。

### HiperLan技术与标准

#### HiperLan技术的基本概念

HiperLan是一种在欧洲应用的无线局域网通信标准的一个子集，有HiperLan/1和HiperLan/2两种标准。

​    HiperLan/1采用**5GHz**射频频率，上行速率可达**20Mb/s**。HiperLan/2同样采用**5GHz**射频频率，上行速率可达**54Mb/s**。 HiperLan/2系统同3G标准兼容。

​    在HiperLan/2的典型网络拓扑结构中，移动终端通过接入点接入固定网。一个AP所覆盖的区域范围在**室内一般为30米**，在**室外一般是150米**。

#### HiperLan/2的主要技术特点

1. **高速数据传输 ：采用OFDM调制技术。**

2. **面向连接** 

### IEEE802.11标准

#### IEEE802.11标准的基本概念

IEEE802.11标准定义了两种类型的设备：**无线结点**和**无线接入点**。**无线节点通常是在一台接入设备上加上一块无线网络接口卡构成。无线接入点的作用是提供无线和有线网络之间的桥接**。

802.11定义了使用红外、调频扩频、直接序列扩频技术，传输速率为1或2Mbps的无线局域网标准。**两个扩频技术**，**一个红外规范**。 **FHSS（调频扩频）和DSSS（直序扩频）**

无线传输频道定义在**24.G.Hz**的ISM波段内。

目前使用的标准主要有： IEEE802.11b、IEEE802.11a和IEEE802.11g。

1. **802.11b协议**

​    802.11b协议的无线网络工作在**2.4GHz**频率下，最大传输速率可以达到**11Mb/s**，它可以实现速率在**1Mb/s、2Mb/s、5.5Mb/s以及11Mb/s**之间的自动切换 。

2. **802.11a协议**

​    工作在**5GHz**的频率下，数据传输速率可以达到**54Mb/s**，传输距离在**10 ~100m** 。

3. **802.11g协议**

​    它是在802.11b协议的基础上改进的协议，支持**2.4GHz**工作频率以及DSSS技术 ，它可以实现11Mb/s传输速率，同时**保持着对802.11b的兼容**，又可以实现**54Mb/s**高传输速率 。

| **属性**       | **802.11b**        | **802.11a**         | **802.11g**                                                  |
| -------------- | ------------------ | ------------------- | ------------------------------------------------------------ |
| 批准的IEEE标准 | 是                 | 是                  | 是                                                           |
| Wi-Fi联盟认证  | 是                 | 是                  | 否                                                           |
| 最大传输速率   | 11 Mb/s            | 54Mb/s              | 54Mb/s                                                       |
| 实际吞吐量     | 5~7Mb/s            | 28~31Mb/s           | 28~31Mb/s（全部在802.11g环境）  10~12Mb/s（与802.11b客户端混合环境） |
| 最大容量       | 33 Mb/s   3信道*11 | 432 Mb/s   8信道*54 | 162 Mb/s   3信道*54                                          |

| **属性**              | **802.11b**                                                  | **802.11a**                                   | **802.11g**                                                  |
| --------------------- | ------------------------------------------------------------ | --------------------------------------------- | ------------------------------------------------------------ |
| 与802.11b的后向兼容性 | 是  在2.4GHz ISM频段上运行，客户端以8.2.11b的速度在802.11b和802.11g Aps上运行 | 否  在5GHz UNI频段上运行                      | 是  在2.4GHz ISM频段上运行，客户端以8.2.11b的速度在802.11bAps上运行，以8.2.11g的速度在802.11g Aps上运行 |
| 与其他设备之间的干扰  | 是  如无线电话、蓝牙、微波炉                                 | 否                                            | 是  如无线电话、蓝牙、微波炉                                 |
| 室内距离              | 30m                                                          | 与802.11b和802.11g  相比，在30m内有更快的速度 | 与802.11b相比，在30m内有更快的速度                           |

#### IEEE802.11b的基本运作模式

802.11b运作模式基本分为两种：**点对点模式**和**基本模式**。

​    **点对点模式**是指**无线网卡和无线网卡**之间的通信方式。只要PC插上无线网卡即可与另一具有无线网卡的PC连接，对于小型的无线网络来说，是一种方便的连接方式，**最多可连接256台PC**。

​	**基本模式**是指无线网络规模扩充或无线和有线网络并存时的通信方式，这是802.11b最常用的方式。此时，插上无线网卡的PC需要由接入点与另一台PC连接。接入点负责频段管理及漫游等指挥工作，**一个接入点最多可连接1024台PC**（无线网卡）。当无线网络节点扩增时，网络存取速度会随着范围扩大和节点的增加而变慢，此时添加接入点可以有效控制和管理频宽与频段。无线网络需要与有线网络互连，或无线网络节点需要连接和存取有线网的资源和服务器时，**接入点可以作为无线网和有线网之间的桥梁**。

#### 802.11b的典型解决方案

1. 对等解决方案：每台电脑安装一片无线网卡。 

2. 单接入点解决方案：接入点相当于集线器。 

3. 多接入点解决方案：所有无线终端可通过就近接入点接入网络。 

4. 无线中继方案：无线接入器充当有线网络的延伸。 

5. 无线冗余解决方案：多接入点放在同一位置防止设备失效。 

6. 多蜂窝漫游工作模式：与移动电话类似。 （**部署多个接入点，自动切换们服务不中断**）

### 常用的无线局域网设备

1．无线网卡

​    无线网卡在无线局域网中的作用相当于有线网卡在有线局域网中的作用。两台计算机只要各自插上无线网卡，就可以实现通信。 

2．无线接入点

​    无线接入点也称为**无线AP**，它是在无线局域网环境中，进行数据发送和接收的集中设备，它的作用相当于有线网络中的集线器。通常，一个AP能够连接**30台**左右的无线网络终端或者其他的无线AP

3．天线

​    天线的功能是使无线信号有较大的信噪比，以提高数据传输的稳定性和可靠性，一般都要将AP连接上天线上。一般分为室内天线和室外天线。 

4．**无线网桥、路由器及网关**

​    **无线网桥主要用于连接几个不同的网段**，实现较远距离的无线数据通信。**无线路由器和无线网关**是具有路由功能的AP，一般情况下它**具有NAT功能**，因此可以用它建立一个更小的无线局域网。

### 无线接入点的安装与调试

#### Aironet 1100系列接入点概述

Cisco公司的Aironet 1100系列接入点是一款**无线局域网收发器**，主要用于独立无线网络的中心点或无线网络和有线网络之间的连接点。它**兼容IEEE 802.11b和IEEE 802.11g**，工作在**2.4GHz**频率段。使用**IOS**操作系统。

#### 将接入点接入网络

1. 安装和配置AP之前，先向网络管理员询问以下信息：

- **系统名**
- 无线网络中对**大小写敏感的服务集标识符（SSID）**
- **如果没有连接到DHCP服务器，则需要为接入点指定一个唯一的IP地址。**
- **如果接入点与PC不在同一个子网内，则需要子网掩码和默认网关**
- 简单网络管理协议（SNMP）集合名称以及SNMP文件属性（如果使用SNMP）

2. 可以用线内供电连接以太网和使用本地电源。

#### 配置接入点

第一次配置无线接入点，一般采用**本地配置方式**，即无需将无线接入点连接到一个有线的网络中。它的**默认IP地址是10.0.0.1**，并成为小型的DHCP服务器。可以为下列设备分配20个**10.0.0.x**范围的IP地址：

- 连接在接入点以太网端口上的PC机。
- 没有配置SSID或SSID配置为**tsunami**（默认SSID），并且关闭所有安全配置的无线设备。

本地连接无线接入点的步骤：

①使用五类以太网电缆连接PC机和无线接入点

②给无线接入点加电

③确认PC获得了10.0.0.x网段的地址

④打开浏览器，在浏览器的地址栏输入**10.0.0.1**，按回车键

⑤按Tab键越过用户名字段，输入**大小写敏感的密码Cisco**，然后确认。 点击“**Express Setup**”**进入快速配置页面**，在各输入框中填入相关的配置信息。

各个配置参数的含义：

- System name
- Configuration server protocol
- Ip address
- Ip subnet mask
- Default gateway
- Radio service set ID（SSID）:**大小写区分，SSID是客户端设备用来访问接入点的唯一标识**。
- Broadcast SSID in beacon ：**设定允许设备不指定SSID而访问接入点。YES选项是默认设置**，允许设备不指定SSID而访问接入点，NO选项表示设备必须指定SSID访问接入点

## 计算机网络信息服务系统的安装与配置

### DNS域名系统

DNS是Domain Name System的缩写，中文的含义是**域名系统**。。将人们易于记忆的域名与人们不容易记忆IP地址进行转换。执行此项功能的主机被称为DNS Server。

#### DNS服务器的分类

- 根服务器：在因特网上共有13 个根域名服务器（标号为a~m）。
- 顶级服务器：负责顶级域名（如com、org、net、edu和gov）和所有国家的顶级域名（如cn）
- 权威服务器：在Internet上具有公共访问主机（如WWW服务器和FTP服务器）的每个组织机构必须提供公共可访问的DNS记录。

#### DNS系统工作原理

当DNS客户机提出查询请求时，首先查询本地缓存中查找。如果没有符合条件的记录，则产生一个查询请求发给本地DNS服务器。本地DNS服务器,当本地DNS服务器接到查询后，首先在该服务器管理的区域的资源记录中查找，如果找到该记录，则将解析结果返回DNS客户机；如果没有满足查询请求的记录，服务器在本地的缓存中查找；如果找到相应记录，则结果过程结束，否则按系统设置将查询请求发送到其他DNS服务器查询；客户机如果在规定的时间内未收到查询响应，会尝试其他的DNS服务器或再次查询

#### DNS服务器配置的主要参数

1.**正向查找区域**

域名->IP地址；（A）资源记录

2.反向查找区域

IP地址->域名；添加（A）资源记录时，使用“添加PTR记录”自动添加到反向查找区域

3.地址资源记录

　　一组结构化的记录，包括（A）、MX（邮件交换记录）、CNAME（别名）

4.**转发器**

　　本地DNS服务器用于将外部DNS名称的DNS查询转发给该DNS服务器，用于**外部域名**的DNS查询

#### 主要考点

**DNS服务器本机的IP必须静态配置**

主机资源记录的生存时间（TTL）指记录被客户端查询到，存放在**缓存中**的持续时间，默认值是**3600**秒。

DNS服务器中的根DNS服务器**不需**管理员手工配置

通过DNS服务器**监视**对话框可以对DNS服务器进行**简单测试**与**递归查询测试**

使用**nslookup**命令可以测试正向和反向查找区域

清空DNS缓存（DNS cache）的是**ipconfig/flushdns** 

缺省情况下Windows 2003系统**没有安装**DNS服务.

### DHCP服务

DHCP（Dynamic Host Configuration Protocol，动态主机配置协议）分为两个部份：即服务器端和客户端，其中所有的IP网络设定数据都由DHCP服务器集中管理，并负责处理客户端的DHCP要求；而客户端则会使用从服务器分配下来的IP环境数据（如DNS、gateway的设置等）

#### DHCP的工作原理

1.DHCP客户机广播“DHCP发现”消息，试图找到网络中的　　DHCP 服务器获得一个IP地址。该封包的来源地址为0.0.0.0，而目的地址则为 255.255.255.255。

2.当 DHCP 服务器接收到“DHCP发现”消息后，就向网络中广播“DHCP供给”消息，其中包括提供DHCP客户机的地址和相关的配置信息。

3.DHCP客户机收到“DHCP供给”信息，如果接受DHCP服务器所提供的相关参数，就通过广播”DHCP请求”消息向DHCP服务器请求提供IP地址。

4.DHCP服务器广播“DHCP确认”消息，将IP地址分配给DHCP客户端。 

#### DHCP服务器配置的术语、主要参数

1.作用域：作用域是一个网络中的所有可分配的 IP 地址的连续范围。作用域主要用来定义网络中单一的物理子网的 IP 地址范围。

2.排除范围：排除范围是不用于分配的 IP 地址序列。它保证在这个序列中的 IP 地址不会被 DHCP 服务器分配给客户机。　

3.地址池：在用户定义了 DHCP 范围及排除范围后，剩余的地址形成了一个地址池，地址池中的地址可以动态的分配给网络中的客户机使用

4.租约：租约是 DHCP 服务器指定的时间长度，在这个时间范围内客户机可以使用所获得的 IP 地址。当客户机获得 IP 地址时租约被激活。在租约到期前客户机常常需要向服务器更新 IP 地址的租约

5.保留地址：用户可以利用保留地址创建一个永久的地址租约。保留地址保证子网中的指定硬件设备始终使用同一个 IP 地址。**可以使用作用域的任何地址，包括排除范围内的地址**。

6.选项类型：选项类型是 DHCP 服务器给 DHCP 工作站分配服务租约时分配的其它客户配置参数。经常使用的　　选项包括：默认网关的 IP 地址（路由器）, WINS 服务器, 及 DNS 服务器的IP地址。

#### 主要考点

1.DHCP工作原理（四次交互）

2.添加排除时必须输入起始IP地址和结束IP地址（不需MAC地址）

3.新建作用域后必须激活才可为客户机分配地址

4.地址租约期限决定客户机使用所获得IP地址的时间长短，最小可调整单位是分钟，客户端自动续约

5.保留是指DHCP服务器指派的永久地址租约，添加保留地址时需获得客户机的MAC地址信息。可以使用排除地址范围。

6.DHCP中继。

7.ipconfig /all（查看到该客户机的配置信息和地址租约） 

  ipconfig/release（释放已获得的IP地址租约）

  ipconfig /renew命令（重新从DHCP服务器获得新的IP地址租约）

### WWW服务

浏览器与服务器之间传送信息的的协议时**HTTP**，即超文本传输协议，使用**TCP协议**，默认端口号为**80**。

#### 主要考点

1.建立Web 站点时，必须为该站点指定一个主目录，也可以是虚拟子目录 。

2.Web站点必须设置网站的默认文档后才能自动打开“default.html”或”index.html”等页面。

3.在网站的选项中的可设置网站的标识、连接限制、以及启用日　志记录和日志记录格式。　　Web站点可设置静态的IP地址或全选“全部未分配”

4.目录安全选项可选择配置身份验证和访问控制、IP地址和域名限制、安全通信

5.使用IIS建立Web站点设置选项时性能选项，可设置影响带宽使用的属性及客户端Web连接的数量。（**无时间**）

6.网站性能选项中，带宽限制选项限制该网站的可使用带宽

7.访问WEB站点的方法。 

8.在IIS6.0中用虚拟服务器构建多个网站的方法：可以为服务器上的每个站点配置唯一的**标识**或虚拟目录。标识有包括：**主机头名称、IP地址、非标准TCP端口号**。

### FTP服务

​       文件传送协议（FTP）允许用户从服务器上获取文件副本并下载到本地计算机上，或将本地计算机上的一个文件上传到服务器。

　　不需要用户登录就能自由下载文件的FTP服务成为匿名FTP服务。

　　FTP的传输层使用TCP协议，服务器端提供的端口号**21用于数据连接**，**端口号20用于数据传送**

#### FTP服务器配置的主要参数

1.域：FTP可建立多个虚拟服务器，每个虚拟服务器成为域，**一个域是由IP地址和端口号唯一识别**

2.匿名用户：对名为**anonymous**的用户自动识别为**匿名用户**，**不设置密码**。

3.命名用户：创建时设置密码，此类用户一般提供更多的访问权限。

4.组：用户组就是将多个命名用户组织在一起，它们拥有相同的权限，这些权限只需在组的选项中设置即可。

#### FTP服务器的配置

1.修改管理员密码 （默认管理员:LocalAdministrator），在初次运行的情况下，没有设置管理员的密码

2.新建域（11上、13上考题）

①在Serv-U的管理界面左侧的目录树中选中“域”图标，在菜单栏中选中“域”菜单选项，在显示的下拉菜单中选中“新建域（N）” 。这时界面上将弹出“添加新建域-第一步”对话框。

②在“IP地址”框中输入FTP服务器的IP地址，这里为“192.168.0.111”，点击【下一步（N）】,进入“添加新建域-第二步” 。

　　**IP地址可为空，意为服务器的所有IP地址**。当服务器有多个IP或动态IP时，比较方便。

③在“域名”框中输入该服务器的域名，即它的描述名称，这里为“ftp.myftp.com”，点击【下一步（N）】,进入“添加新建域-第三步” 。**可以使用域名**

④在“域端口号”中输入该服务器的端口号。默认的端口号为“21”，也**可以设置自己想要的端口号**。当然存在一些情况这个21端口，不能使用，这时也该使用别的端口，这里设置该服务器的端口号为“8021”，点击【下一步（N）】,进入“添加新建域-第四步”

⑤在“域类型”对话框中选择域存储的地方。**“.INI文件存储”一般是应用于较小的域，对于用户数大于500的较大的域，应该选择注册表以提供更高的性能**。点击【下一步（N）】，完成FTP服务器的创建。

3.用户的添加与管理（09上、09下、11下）

①在Serv-U的管理界面的左侧目录树中选择【域】→【ftp.myftp.com】→【用户】，在菜单栏选中“用户（U）”选项，在弹出的下拉菜单中选中“新建用户（N）”，将弹出“添加新建用户-第一步”对话框。

　　**注意：在服务器端创建**

②在“用户名称”框中输入所要添加的用户的用户名，这里设置为“user”，**如果是匿名用户，则输入用户名“anonymous”**，点击【下一步（N）】，进入“添加新用户-第二步”对话框。**注意：要手工添加**

③在“密码”框中输入该用户名访问FTP时所使用的密码，这里为“123456”，当输入的用户名为“anonymous”时，系统自动判定添加的为匿名用户，将不进入这一步。点击【下一步（N）】，进入“添加新用户-第三步”对话框。

④在“主目录”输该用户访访问FTP时的主目录，或者点击框右面的图标，进行主目录的选择，这里为“D:\共享文件夹”，点击【下一步（N）】，进入“添加新用户-第四步”对话框。

⑤选择“是否锁定用户主目录?”后，点击【完成】，完成了添加新用户的操作。   

#### 常用选项

1）服务器选项

　　在Serv-U的管理界面的左侧目录树中选择【<<本地服务器>>】→【设置】即可打开服务器设置选项对话框。 

（1）最大上传速度，最大下载速度：**指整个FTP服务器占用的带宽**。

（2）最大用户数量：**同时在线的最大用户数**。

（3）检查匿名密码

（4）删除部分已上传文件

（5）禁用反超时调度

（6）拦截“FTP_bounce”攻击和FXP。

　　**只允许在FTP客户端和服务器间进行文件传输，而不允许在两个FTP服务器间进行文件传输**

2）域设置选项

　　在Serv-U的管理界面的左侧目录树中选择

【<<本地服务器>>】→【域】→【ftp.myftp.com】→【设置】，则显示“域设置”界面。

（1）域常规选项

（2）域虚拟路径选项

（3）IP访问选项

（4）域消息选项

（5）域记录选项

（6）域上传/下载率选项

（7）域高级选项

3）用户选项

　　在Serv-U的管理界面的左侧目录树中选择【<<本地服务器>>】→【域】→　　【ftp.myftp.com】→【用户】,选中一个用户，如“user”即可打开用户设置对话框。

（1）用户帐号选项

（2）用户常规选项

（3）用户目录访问选项

（4）**用户IP访问选项**

（5）用户上传/下载率选项

（6）**用户配额选项**

　　**可以限制用户上传信息占用的存储空间**

#### 使用浏览器测试FTP服务器

在浏览器的地址栏中输入服务器的IP地址，如“**ftp:192.168.0.111**”，如果该服务器的端口号不是21，则还需要加上端口号来访问该FTP服务器，格式为：“**ftp:192.168.0.111:8021**”。连接后，可以选择使用匿名方式登录FTP服务器，也可以通过输入正确的用户名和密码来登录对话框。 

### E-mail服务

完整的电子邮件地址（例如，user1@mail.abc.com）由两部分构成，第一部分为信箱名（user1），第二部分为邮件服务器的域名（mail.abc.com）中间用@隔开。**发送方的邮件服务器在发送邮件时根据第二部分来确定要连接的接收方邮件服务器；接收邮件服务器软件则使用信箱名来选择对应的邮箱将收到的邮件存储起来**。

电子邮件系统使用的协议主要有：**SMTP**，**用于发送电子邮件**，默认的**TCP端口为25**；**POP3**，默认的**TCP端口为110**；**IMAP4**，默认的**TCP端口为143**。用户**访问**并**读取**邮件服务器上的邮件使用POP3或IMAP4协议。

## 网络安全技术

### 网络攻击

1.服务攻击（DOS）

　　指对网络中提供给某种服务的服务器进行攻击，使其“拒绝服务”而造成网络无法正常工作。 

2.非服务攻击（如对网络设备攻击、源路由攻击和地址欺骗）

　　利用协议或操作系统实现协议时的漏洞来达到攻击的目的，它不针对于某具体的应用服务，因此非服务攻击是一种更有效的攻击手段。 

3.非授权访问

　　存储在联网计算机中的信息或服务被未授权的网络用户非法使用，或者被授权用户越权滥用。

4.网络病毒

### 网络安全模型

1. 网络安全模型

　　在网络信息传输中，为了保证信息传输的安全性，一般需要一个值得信任的第三方，负责向源结点和目的结点进行秘密信息分发，同时在双方发生争执时，也要起到仲裁的作用。在基本的安全模型中，通信的双方在进行信息传输前，先建立起一条逻辑通道，并提供安全的机制和服务，来实现在开放网络环境中信息的安全传输。

2. P2DR模型

①**安全策略（Policy）**是模型中的防护、检测和响应等部分实施的依据，一个安全策略体系的建立包括策略的制定、评估与执行。 包括**安全策略和具体安全规则**。

②**防护（Protection）**防护技术包括：防火墙、操作系统身份认证、数据加密、访问控制、授权、虚拟专用网技术和数据备份等，它对系统**可能出现的安全问题采取预防措施**。 

③**检测（Detection）**检测功能使用漏洞评估、入侵检测等系统检测技术，当攻击者穿透防护系统时，发挥功用。

④**响应（Response）**响应包括**紧急响应和恢复处理**，而恢复又包括系统恢复和信息恢复，响应系统在检测出入侵时，开始事件处理的工作

### 网络安全规范

可信计算机系统评估准则（TCSEC)将计算机系统安全等级分为A．B．C．D这4类，共有7级。即D．C1、C2、B1、B2、B3与A1。其中，**D级系统的安全要求最低，A1级系统的安全要求最高**

**D级**系统属于非安全保护类，它**不能用于多用户环境下的重要信息处理**。**C类**系统是用户能定义访问控制要求的**自主保护类型**。**B类**系统属于强制型安全保护系统，即**用户不能分配权限**，只有管理员可以为用户分配。**一般的UNIX系统通常能满足C2标准**

### 数据备份方法

#### 基于策略

1.完全备份

　　完全备份即是将用户指定的数据甚至是整个系统的数据进行完全的备份。

2.增量备份

　　增量备份是针对完全备份，在进行增量备份，只有那些在上次完全或者增量备份后被修改了的文件才会被备份

3.差异备份

　　差异备份是将最近一次完全备份后产生的所有数据更新进行备份。差异备份将完全恢复时所涉及到的备份文件数量限制为2个

|          | 空间使用     | 备份速度     | 恢复速度     |
| -------- | ------------ | ------------ | ------------ |
| 完全备份 | 最多         | 最慢         | 最快         |
| 增量备份 | 最少         | 最快         | 最慢         |
| 差异备份 | 少于完全备份 | 快于完全备份 | 快于增量备份 |

### 防病毒技术

恶意代码

1.蠕虫

　　蠕虫是是一个自我包含的程序，它能够传播自身的功能或拷贝自身的片段到其他计算机系统（通常是通过网络连接）。

2.木马

　　“木马”通常寄生在用户计算机系统中，盗用用户信息，并通过网络发送给黑客。与病毒不同之处在于**没有自我复制功能**。

　　传播途径：**电子邮件、软件下载、会话软件**

防病毒软件安装与配置

一、网络版防病毒系统结构

1.系统中心

　　系统中心实时记录计算机的病毒监控、检测和清除的信息，实现对整个防护系统的自动控制。

2.服务器端

　　服务器端为网络服务器操作系统应用而设计。

3.客户端

　　客户端对当前工作站上病毒监控、检测和清除，并在需要时向系统中心发送病毒监测报告。

4.管理控制台

　　管理控制台是为了网络管理员的应用而设计的，通过它可以集中管理网络上所有已安装的防病毒系统防护软件的计算机。

　　**管理控制台既可以安装到服务器上也可以安装在客户机上，视网络管理员的需要，可以自由安装**。

二、网络版防病毒系统安装

　　对于大多数的网络版的防病毒系统，**服务器端和客户端通常可以采用本地安装、远程安装、Web安装、脚本安装等方式进行安装**。

　　控制台的安装通常有两种方式：通过光盘安装控制台、远程安装控制台，系统管理员可以将管理控制台远程安装到其他计算机上。

三、网络版防病毒系统的主要参数配置

１．系统升级

　　**从网站升级、从上级中心升级、从网站上下载手动数据包。**

2.扫描设置

3.黑白名单设置

4.端口设置

　　**为了使网络版防病毒软件的通信数据能顺利的通过防火墙，通常系统都会提供用于数据通信端口设置的界面。（非固定端口）**

### 防火墙技术

一、防火墙的主要功能：

1.所有的从外部到内部的通信都必须经过它。

2.只有有内部访问策略授权的通信才能被允许通过。

3.具有防攻击能力，保证自身的安全性。

二、**防火墙的分类**：

　　防火墙在网络之间通过执行控制策略来保护网络系统，防火墙包括硬件和软件两部分。防火墙根据其实现技术可以分为：**包过滤路由器、应用网关、应用代理**和**状态检测**4类。

三、防火墙的系统结构

1.包过滤型结构

　　包过滤型结构是通过专用的包过滤路由器或是安装了包过滤功能的普通路器来实现的。包过滤型结构对进出内部网络的所有信息进行分析，按照一定的安全策略对这些信息进行分析与限制。 

2.双宿网关结构

　　双宿网关结构即是一台装有两块网卡的主机作为防火墙，将外部网络与同部网络实现物理上的隔开。应用级网管完全暴露个整个外部网络，人们将处于防火墙关键部位、运行应用级网管软件的计算机系统成为**堡垒主机**。

3.屏蔽主机结构

　　屏蔽主机结构将所有的外部主机强制与一个堡垒主机相连，从而不允许它们直接与内部网络的主机相连，因此**屏撇主机结构是由包过滤路由器和堡垒主机组成的**。 

4.屏蔽子网结构

　　**屏蔽子网结构使用了两个屏蔽路由器和两个堡垒主机**。在该系统中，从外部包过滤由器开始的部分是由网络系统所属的单位组建的，属于内部网络，也称为“**DMZ网络**”。外部包过滤路由器与外部堡垒主机构成了防火墙的过滤子网；内部包过滤路由器和内部堡垒主机则用于对内部网络进行进一步的保护。

### 网络入侵检测系统的部署

一、网络入侵检测系统的组成结构

 1.控制台

  探测器

二、网络入侵检测系统常用部署方法

①网络接口卡与交换设备的监控端口连接，通过交换设备的Span/Mirror功能将流向个端口的数据包复制一份给监控端口。

②在网络中增加一台集线器改变网络拓扑结构，通过集线器（共享式监听方式）获取数据包。

③入侵检测传感器通过一个TAP（分路器）设备对交换式网络中的数据包进行分析和处理。

**TAP是一种容错方案，它提供全双工或半双工10/100/1000M网段上观察数据流量的手段**，其优点为：

　　TAP是容错的，如果发生电源故障，原先监控的网段上的通信部受影响。

　　TAP不会影响数据流

　　TAP阻止建立于入侵检测系统的直接连接，从而保护它不受攻击

### 网络安全评估

一、网络安全评估分析技术

1.基于应用的技术（被动）

2.基于网络的技术（主动）

　　网络安全风险评估技术通常用来进行**穿透实验**和**安全审计**。

二、网络安全评估分析系统结构

　　通常采用**控制台**和**代理相结合**的结构。

## 网络管理技术

### 网络管理的基本知识

网络管理系统一般由管理进程、被管对象、代理进程、管理信息库和网络管理协议五部分组成。 

1.管理进程：也称管理站，是网络管理的主动实体。

2.被管对象：网络上的软硬件设施。

3.代理进程：网络管理中的被动实体。

4.网络管理协议：较流行的有SNMP和CMIP

5.管理信息库：被管对象概念上的集合。

网络管理的功能

1.配置管理

2.性能管理

3.记账管理

4.故障管理

5.安全管理

### 网络管理模型

一、OSI管理模型

OSI管理模型由ISO公布。

二、SNMP管理模型

　　SNMP由一系列协议组和规范组成，它们提供了一种从网络上的设备中收集网络管理信息的方法。SNMP的体系结构分为**SNMP管理者**、**SNMP代理**和**MIB**，其管理模型是一个管理/代理模型 。每一个支持SNMP的网络设备中都包含一个网管代理，网管代理随时记录网络设备的各种信息，网络管理程序再通过SNMP通信协议收集网管代理所记录的信息

1.SNMP的管理站和代理

　　SNMP采用一种分布式结构。一个管理站可以管理控制着多个代理；反之，一个代理也可以被过个管理站所管理、控制。为此，SNMP采用了“团体”这个概念来实现一些简单的安全控制。

2.管理信息库 MIB-2

　　管理信息库MIB也称为MIB-2，它指明了网络元素所维持的变量。MIB给出了一个网络中所有可能的被管理对象的集合的数据结构。

　　**Cisco的管理对象标识符（OID）**都是由**1.3.6.1.4.1.9**开头的。

　　MIB的应用类型中的**计量器**类型与计数器很类似，不同之处在于它的值**可以增加也可以减少**。

3.SNMP支持的操作

①**get**：用于管理站向代理查询被管理设备上的MIB库数据。 

②**set**：用于管理站命令代理对被管设备上MIB库中的对象值进行设置。 

③**notifications**：用于代理主动向管理站报告被管对象的某些变化。通知又乐意进一步分为自陷（Trap）和通知（Inform）两类。

　　每个操作都有相应的**PDU**格式。

4.SNMP的实现

三、CMIP与SNMP的比较

1.SNMP的特点

①简单，易于在各种网络中实现。

②广泛支持，机会所有的网络产品都支持SNMP。

③操作原语简捷。

④性能高。

2.CMIP的特点：

①每个变量不仅传递信息，而且还完成一定的网络管理任务，这样可减少管理者的负担减少网络负载。

②安全性高，拥有验证、访问控制盒安全日志。

3.SNMP和CMIP的不同点

①**SNMP**有广泛的适用性，且在**用于小规模设备时成本低、效率高**，而CMIP更适用于大型网络。

②SNMP主要基于轮询方式获得信息，CMIP主要采用报告方式。

③SNMP基于**UDP**,CMIP使用面向连接的传输。

④CMIP采用面向对象的信息建模方式，SNMP用简单的变量表示管理对象。

### 互联网控制报文协议ICMP

​		ICMP工作在**网络层**，是一种管理协议，用于在IP主机、路由器之间**传递控制消息和差错报告**。

　　**ICMP消息被封装在IP数据包内**，通过IP包传送的ICMP信息主要是设计错误操作的报告和会送给源节点的关于IP数据包处理的消息

​    **ICMP消息类型**

| 类型号 | 类型描述         | 类型号 | 类型描述           |
| ------ | ---------------- | ------ | ------------------ |
| 0      | **回送应答**     | 12     | 参数错误           |
| 3      | **目标不可到达** | 13     | 时间戳请求         |
| 4      | 源抑制           | 14     | 时间戳应答         |
| 5      | 重定向           | 15     | 信息请求（已作废） |
| 8      | **回送请求**     | 16     | 信息应答（已作废） |
| 9      | 路由器请求       | 17     | 地址掩码请求       |
| 10     | 路由器恳求       | 18     | 地址掩码应答       |
| 11     | **超时**         |        |                    |

ICMP的主要功能：

①通告网络错误： （目标不可到达报文）

②通告网络拥塞： （源抑制报文）

③帮助查找网络故障： （回送请求与回送应答报文）

④通告超时： （超时报文）

⑤路由重定向： （重定向报文）

⑥检查IP协议的错误： （参数错误报文）

⑦测量指定路径上的通信延迟： （时间戳）

⑧获取子网掩码： （掩码请求与掩码应答）

### 常用网络管理软件的安装与配置

一、网络管理软件的常见功能

①网络性能监控：提供带宽测量、路由CPU负荷性能　指标的实时监控，以及历时数据统计。

②网络发现和拓扑管理：提供子网列表、ping sweep　和IP网络浏览器

③IP地址管理

④探测功能：提供ping和trace route等

⑤其他：如TFTP服务器等

二、常见网络管理软件安装与配置（12下）

①大型管理平台：

　　**HP Open View、Sun Net Manager、IBM Net View**等。可以对多种网络、协议进行管理，有很好的开放性，支持第三方管理软件的潜入。

②网络设备厂家自身产品的网管软件：

　　如CISCO、Juniper、华为。

③中小型网络通用网管软件：

Solarwinds、MRTG、SNMPc等。

　　这些网络系统都是采用SNMP协议来对网络进行管理的。如果一个网络管理控制多个代理，那么它和这些代理中的每一个都各构成一个团体。

三、网络设备SNMP设置（以cisco路由器为例）

1.创建或修改对SNMP团体的访问控制(08上、10上)

(config)# snmp-server community <团体名>

 [view <视阈名> ] [ro | rw] [<访问控制列表号> ] 其中：

①团体名：用于同一团体内的管理站和代理之间进行通信认证。

②视阈名：规定了本团体内访问管理信息库的范围。

③Ro或rw：代表访问权限为**只读**或**可读写**。

④访问控制表号：**1~99**，标准的ACL，IP范围内的主机为属于这个“团体”的管理站。

**(config)# snmp-server community public 4**

(config)# snmp-server community admin view part rw

2.创建或修改一个SNMP视阈

(config)# snmp-server view <视阈名>

<对象标识符或子树>|included|excluded ]

3.设置路由器上的SNMP代理具有发出通知的功能：
 (config)# snmp-server enable traps

 [<通知类型 >] [<通知选项>]

**管理站对这种报文不必有所应答**

4.在某个接口的配置模式下，指定当该接口断开或连接时要向管理站发出通知； 

(config-if)# snmp trap link-status（链路状态）

5.配置接收通知的管理站

(config)# snmp-server host <主机名或IP地址> 

[traps|informs] [version  1|2c] 

<团体名>[ udp-port<端口号>（默认值为162）] [<通知类型>]

### 利用工具监控和管理网络

一、需求

二、网络监听原理

　　网卡有4 种接收模式：**广播**，**组播**，**单播**，**混杂模式**。嗅探器通过将本地网卡设置为混杂模式，来监听并捕捉其所连接网段的所有网络数据。

三、网络数据监听部署

1.对于**共享型网络**

　　在共享型网络中，只要将嗅探器部署到网络中的任意一个接口上或者插入到任何一个节点的链路中，即可以捕捉到所有数据包。

2.对于交换型网络

　　在交换式网络中，需要采用通过对交换机进行端口镜像的方式，来获得网络中流量。

①配置被镜像端口：

SW(config)#monitor session 1 source interface Gi2/16

②配置镜像端口：

SW(config)#monitor session 1 destination interface Gi2/12

③检查配置：SW#show monitor session 1 

Session 1
 \---------
 Type : Local Session
 Source Ports :
 Both:Gi2/16
 Destination Ports : Gi2/12（目的端口，嗅探器放在这监测源端口）

四、网络数据监听工具（09下）

　　常见的网络数据监听工具有**Sniffer Pro、Ethereal、TCPdump**，Wireshark等，其中Sniffer Pro是一个功能强大的可视化  网络流量监控软件,主要功能包括：

①捕捉网络流量，进行数据包解码分析。

②实时监测网络活动。

③内置分析器诊断网络故障。

④存储各种历时信息，并可进行基线分析。

⑤当探测到网络故障时可以发出警报。

⑥可以模拟生成数据包对网络进行探测。

### 查找和排除故障的基本方法

1.收集故障有关信息

①该计算机使用真实IP地址。

②该计算机能够使用域名访问自己校园网的WWW服务器。

③该计算机与校园网WWW服务器不在同一个网段（VLAN）。

④在同一网段的其他计算机能正常访问www.mircosoft.com 

2.可能造成一台计算机无法浏览某个WWW服务器的原因主要有：

①该计算机的TCP/IP协议工作不正常。

②该计算机的IP地址与掩码设置有误。

③该计算机的网关设置有误。

④该计算机的DNS设置有误。

⑤该计算机系统的浏览器有问题。

⑥提供www.micrisoft.com名字解析的服务器有故障。

⑦服务器www.micrisoft.com工作不正常。

⑧校园网路由设置中存在问题。

⑨**该计算机请求无法到达服务器www.micrisoft.com。**

三、故障测试与分析：

（1）运行命令ping www.microsoft.com测试：

C:\>ping www.microsoft.com

Pinging lb1.www.ms.akadns.net [207.46.19.60（www.microsoft.com 的IP地址）] with 32 bytes of data:

Reply from 202.113.79.1: destination net unreachable  （表明该计算机发出的ping包在202.113.79.1处被阻拦了）

Reply from 202.113.79.1: destination net unreachable

Reply from 202.113.79.1: destination net unreachable

Reply from 202.113.79.1: destination net unreachable

Ping statistics for 207.46.19.60 :

 Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),

Approximate round trip times in milli-seconds:

 Minimum = 0ms, Maximum = 0ms, Average = 0ms

运行命令 tracert www.microsoft.com测试：

C:\>tracert www.microsoft.com

Tracing route to lb1.www.ms.akadns.net [65.55.57.27]

over a maximum of 30 hops:

1<1 ms <1 ms<1 ms 202.113.79.53

2<1 ms <1 ms<1 ms 202.113.79.9

3 202.113.79.1 **reports: destination net unreachable.**（第三跳202.113.79.1存在访问控制。）

Trace complete.

另外：如果出现 request timed out 可能是目标方工作不正常。

### 网络攻击与漏洞查找的基本方法

一、常见的网络入侵与攻击的基本方法

1.木马入侵：C/S结构，不自身复制

2.漏洞入侵：**Unicode漏洞入侵**、**跨站脚本注入**、**sql注入入侵**

3.**协议欺骗攻击**

主要的协议欺骗攻击方式有以下几种：

　　**IP 欺骗攻击、ARP 欺骗攻击、DNS 欺骗攻击、源路由欺骗攻击**

4.口令入侵

5.缓冲区溢出漏洞攻击

6.**拒绝服务攻击**（Dos）

基本方式是通过发送大量合法的请求来消耗和占用过多的服务资源，使得网络服务不能相应正常的请求。常用的DoS 攻击包括：

①Smurf 攻击：攻击者冒充受害者主机的IP地址，向一个大的网络发送echo request的定向广播包，此网络的许多主机都作出回应，受害主机会收到大量的echo reply消息。

②SYN Flooding：利用TCP三次握手过程进行攻击，使用无效的IP地址。

③分布式拒绝服务攻击（DDos）：攻击者攻破了多个系统，并利用这些系统去集中攻击其他目标，成百上千的主机发送大量的请求，受害设备因为无法处理而拒绝服务。

④Ping of Death：通过构造出重组缓冲区大小的异常的ICMP包进行攻击。

⑤Teardrop：利用OS处理分片重叠报文的漏洞进行攻击。

⑥Land 攻击：向某个设备发送数据包，并将数据包的源地址和目的地址都设置成攻击目标地址。

二、漏洞查找办法

漏洞扫描分为被动和主动两种。**被动**扫描对网络上的流量进行分析，不产生额外流量，类似于**IDS**。主动扫描可能会影响网络系统的正常运行。

　　常用的漏洞扫描攻击有：**ISS，Microsoft Baseline Security Analyzer，X-Scanner**

1. ISS扫描器是**主动扫描**的一种。

　　Internet Scanner对**网络设备**进行自动的安全漏洞分析。

　　System Scanner是在系统层上通过**依附于主机**上的扫描器代理侦测主机内部的漏洞。

2. X-Scanner采用**多线程方式**对指定IP地址段进行安全漏洞是扫描，支持插件功能，提供了**图形界面**和**命令行**两种操作方式。

3. MBSA是微软的安全评估工具。

三、漏洞修补方法（09上）

　　**Microsoft Windows Server Update Services (WSUS)** 是用来实时发布微软公共操作系统软件更新程序的服务器，WSUS通过Internet和微软公司Microsoft Windows Server Update Services实时连接，及时获得微软公司最新更新程序，大大缩短了网内计算机执行重大更新时的时间过程。

　　可更新部署Windows Server 2003、Windows 2000 Server 和 Windows XP 、Office XP、Exchange server2003以及SQL server2000和更高版本的更新。

## 综合题

### 路由器配置

静态路由配

Router（config）# **ip route <目的网络地址><子网掩码><下一跳路由器的IP地址>** 

如：Router（config）# ip route 59.65.96.0 255.255.240.0 222.112.37.1

**默认路由配置**

Router（config）# **ip route 0.0.0.0 0.0.0.0 <下一跳路由器的IP地址>** 

如：Router（config）# ip route 0.0.0.0 0.0.0.0 222.112.37.1

**POS接口配置**

Router（config）# Interface POS3/0 

Router（config-if）# Description TO BEIJING 

Router（config-if）# **Bandwidth 2500000 (单位bps)**

Router（config-if）# Ip address 212.14.37.18 255.255.255.252 

Router（config-if）# **Crc 32 （可选的CRC校验位是16和32）**

Router（config-if）# **Pos framing sdh （可选帧格式是SDH和SONET）**

Router（config-if）# No ip directed-broadcast 

Router（config-if）# **Pos flag s1s0 2** 

  （**s1s0=00表示是SONET帧数据，s1s0＝10（十进制2）表示是SDH帧**）

广域网同步串行接口配置

Router（config）# Interface s1/1 

Router（config-if）# Description TOBEIJING 

Router（config-if）# **Bandwidth 2048 （带宽为2M）注意单位为bps**

Router（config-if）# Ip address 212.112.41.81 255.255.255.252 

Router（config-if）# **Encapsulation** hdlc （**封装HDLC或PPP协议，HDLC为缺省**）

// encapsulation的拼写

 Router（config-if）# No ip directed-broadcast 

Router（config-if）# No ip proxy-arp 

Router（config-if）# No shutdown 

Router（config-if）# Exit 

**OSPF配置**

一、启用OSPF ：

在全局模式下：router ospf <process ID>

二、在OSPF配置模式下，定义参与OSPF的子网地址,使用命令：

**area <区域号> range <子网地址><子网掩码>；和**

**network <子网号> <wildcard-mask> area <区域号>**

​    如果区域中的子网是连续的，则可使用这个子网聚合功能，区域边缘路由器可以将所有连续的子网聚合为一条路由信息传播给其他区域，在其他区域内的路由器看到这个区域的路由就只有一条。 **注意：同区域在定义参与OSPF的子网地址时也可以子网聚合**

![image-20210323101942248](C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210323101942248.png)

![image-20210323101958092](C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210323101958092.png)

![image-20210324093652155](C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210324093652155.png)

![image-20210324094627442](C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210324094627442.png)

![image-20210324102034191](C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210324102034191.png)

![image-20210324131436805](C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210324131436805.png)

![image-20210325144924390](C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210325144924390.png)

![image-20210326193429768](C:\Users\24394\AppData\Roaming\Typora\typora-user-images\image-20210326193429768.png)